import{s as i,F as c}from"./Basemap-CmtSPRGE.js";import{u as h,s as f,b as I,x as R,_ as w,n as x,V as q,r as T,K as U,f as M}from"./index-BmjI5m14.js";const p=()=>x.getLogger("esri.support.basemapUtils");function O(){return{}}function D(e){for(const t in e){const a=e[t];h(a),delete e[t]}}function E(e,t){let a;if(typeof e=="string"){const n=e in i,r=!n&&e.includes("/");if(!n&&!r){const l=Object.entries(i).filter(([s,u])=>f.apiKey&&!u.classic||!f.apiKey&&(u.classic||u.is3d)).map(([s])=>`"${s}"`).sort().join(", ");return p().warn(`Unable to find basemap definition for: ${e}. Try one of these: ${l}`),null}t&&(a=t[e]),a||(a=n?c.fromId(e):new c({style:{id:e}}),t&&(t[e]=a))}else a=I(c,e);return a!=null&&a.destroyed&&(p().warn("The provided basemap is already destroyed",{basemap:a}),a=null),a}function F(e){var t;return((t=e.portalItem)==null?void 0:t.type)==="Web Scene"||e.referenceLayers.some(a=>a.type==="scene")}function W(e){var t,a;return!!((a=(t=e==null?void 0:e.portalItem)==null?void 0:t.tags)!=null&&a.some(n=>n.toLowerCase()==="beta"))}function k(e){let t=null;const a=o(e),n=!(a!=null&&a.baseLayers.length);for(const r in i){const l=S(a,v(i[r]),{mustMatchReferences:n});if(l==="equal"){t=r;break}l==="base-layers-equal"&&(t=r)}return t}function _(e,t){var a,n;return e===t||((a=e==null?void 0:e.portalItem)==null?void 0:a.id)!=null&&e.portalItem.id===((n=t==null?void 0:t.portalItem)==null?void 0:n.id)?!0:S(o(e),o(t),{mustMatchReferences:!0})==="equal"}function z(e){return!!(e!=null&&e.baseLayers.concat(e.referenceLayers).some(A))}function A(e){if(y(e.url))return!0;if(e.type==="vector-tile")for(const t in e.sourceNameToSource){const a=e.sourceNameToSource[t];if(y(a==null?void 0:a.sourceUrl))return!0}return!1}function H(e,t){var l;if(t==null||e==null)return{spatialReference:null,updating:!1};if(t.loadStatus==="not-loaded")return t.load(),{spatialReference:null,updating:!0};if(t.spatialReference)return{spatialReference:t.spatialReference,updating:!1};if(t.baseLayers.length===0)return{spatialReference:null,updating:!1};const a=t.baseLayers.at(0);switch(a.loadStatus){case"not-loaded":a.load();case"loading":return{spatialReference:null,updating:!0};case"failed":return{spatialReference:null,updating:!1}}const n=(("supportedSpatialReferences"in a?a.supportedSpatialReferences:null)||["tileInfo"in a?(l=a.tileInfo)==null?void 0:l.spatialReference:a.spatialReference]).filter(Boolean),r=e.spatialReference;return r?{spatialReference:n.find(s=>r.equals(s))??n[0]??null,updating:!1}:{spatialReference:n[0],updating:!1}}const K=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;function y(e){if(!e)return!1;const t=new R(w(e));return!!t.authority&&K.test(t.authority)}function o(e){return e?!e.loaded&&e.resourceInfo?v(e.resourceInfo.data):{baseLayers:d(e.baseLayers),referenceLayers:d(e.referenceLayers)}:null}function d(e){return(q.isCollection(e)?e.toArray():e).map(C)}function C(e){var t,a;return{type:e.type,effect:"effect"in e?e.effect:void 0,url:g("urlTemplate"in e&&e.urlTemplate||e.url||"styleUrl"in e&&e.styleUrl||""),minScale:"minScale"in e&&e.minScale!=null?e.minScale:0,maxScale:"maxScale"in e&&e.maxScale!=null?e.maxScale:0,opacity:e.opacity!=null?e.opacity:1,visible:e.visible==null||!!e.visible,sublayers:e.type!=="map-image"&&e.type!=="wms"||e.sublayers==null||(t=e.sublayers)==null?void 0:t.map(n=>({id:n.id,visible:n.visible})),activeLayerId:e.type==="wmts"?(a=e.activeLayer)==null?void 0:a.id:void 0}}function b(e){return e.isReference||e.layerType==="ArcGISSceneServiceLayer"}function v(e){return e?{baseLayers:m((e.baseMapLayers??[]).filter(t=>!b(t))),referenceLayers:m((e.baseMapLayers??[]).filter(t=>b(t)))}:null}function m(e){return e.map(t=>G(t))}function G(e){let t;switch(e.layerType){case"VectorTileLayer":t="vector-tile";break;case"ArcGISTiledMapServiceLayer":t="tile";break;case"ArcGISSceneServiceLayer":t="scene";break;default:t="unknown"}return{type:t,effect:e.effect,url:g(e.templateUrl||e.urlTemplate||e.styleUrl||e.url),minScale:e.minScale??0,maxScale:e.maxScale??0,opacity:e.opacity??1,visible:e.visibility==null||!!e.visibility,sublayers:void 0,activeLayerId:void 0}}function S(e,t,a){return e!=null!=(t!=null)?"not-equal":!e||!t?"equal":L(e.baseLayers,t.baseLayers)?L(e.referenceLayers,t.referenceLayers)?"equal":a.mustMatchReferences?"not-equal":"base-layers-equal":"not-equal"}function L(e,t){if(e.length!==t.length)return!1;for(let a=0;a<e.length;a++)if(!V(e[a],t[a]))return!1;return!0}function V(e,t){if(e.type!==t.type||e.url!==t.url||e.minScale!==t.minScale||e.maxScale!==t.maxScale||e.visible!==t.visible||e.opacity!==t.opacity||!T(e.effect,t.effect))return!1;if(e.activeLayerId!=null||t.activeLayerId!=null)return e.activeLayerId===t.activeLayerId;if(e.sublayers!=null||t.sublayers!=null){if(e.sublayers==null||t.sublayers==null||e.sublayers.length!==t.sublayers.length)return!1;for(let a=0;a<e.sublayers.length;a++){const n=e.sublayers.at(a),r=t.sublayers.at(a);if((n==null?void 0:n.id)!==(r==null?void 0:r.id)||(n==null?void 0:n.visible)!==(r==null?void 0:r.visible))return!1}}return!0}function g(e){return e?U(e).replace(/^\s*https?:/i,"").toLowerCase():""}function J(e){if(!e)return null;const{thumbnailUrl:t}=e;if(t)return t;const a=k(e);return a?i[a].thumbnailUrl:M(e.baseLayers,j)}function j(e){var t;return"portalItem"in e?(t=e.portalItem)==null?void 0:t.thumbnailUrl:void 0}export{W as L,J as O,_ as R,H as U,E as b,F as d,A as j,D as m,z as w,O as y};
