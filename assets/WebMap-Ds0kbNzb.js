const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/queryNamedTraceConfigurations-BxaubaYF.js","assets/index-DMEurr7E.js","assets/index-eHAXgehk.css","assets/ColorBackground-DELE_yvu.js","assets/Cyclical-DzFgk17I.js","assets/Basemap-B_JFXx5r.js","assets/writeUtils-UNPMbZhD.js","assets/catalogUtils-Cj4NyFw1.js","assets/basemapUtils-B4CdTPpj.js","assets/TablesMixin-YgM-0nE_.js","assets/jsonContext-sw1e6Qr2.js","assets/project-DK1RFrrh.js","assets/QueryNamedTraceConfigurationsParameters-DKBZFa--.js","assets/validateNetworkTopology-D3v1m5Ra.js","assets/ValidateNetworkTopologyParameters-CAZVVwga.js","assets/queryAssociations-CA0ETstd.js","assets/Association-Bp57Gtd5.js","assets/QueryAssociationsParameters-CCo4dLCl.js","assets/synthesizeAssociationGeometries-DW2PN1Dh.js","assets/SynthesizeAssociationGeometriesParameters-CHM1bs0z.js","assets/trace-BiX_kHFu.js","assets/TraceParameters-kP7Hjqyp.js","assets/layersCreator-cHKAEJTP.js","assets/portalLayers-CgWd7LcL.js","assets/associatedFeatureServiceUtils-Be2qU27H.js","assets/lazyLayerLoader-D5W_B4F4.js","assets/geometryServiceUtils-8kX1-1eq.js","assets/webdocSaveUtils-UTgJEMNG.js","assets/saveAPIKeyUtils-BuZFWBXe.js","assets/multiOriginJSONSupportUtils-C0wm8_Yw.js","assets/resourceUtils-Brz57xQ0.js","assets/resourceUtils-DkI2CufC.js","assets/saveUtils-BueXMLR6.js"])))=>i.map(i=>d[i]);
import{e as r,y as o,a as d,bg as y,l0 as Vt,o as W,ba as ve,a9 as Ut,aA as nt,A as re,C as N,eM as Lt,f$ as It,nE as $t,g5 as it,nF as Yt,nG as Qt,bd as Xt,n as Ve,I as er,q as At,g7 as _t,g4 as kt,aH as Rt,N as De,P as Ft,fB as Pt,Q as tr,c0 as ie,eH as rr,h as te,dD as ir,W as Gt,bR as or,bS as sr,bQ as nr,fi as ar,gc as lr,nH as pr,dv as oe,jH as ur,ag as Z,fK as ge,g8 as fe,nI as Dt,k as L,k9 as Jt,nJ as dr,fn as ot,J as cr,fD as yr,cc as Mt,V as tt,eI as mr,b as hr,d as wr,mv as gr,lw as vr,jy as fr,g0 as br,he as Me,u as Sr,gG as Ir,ft as Tr,nK as jr,nL as Nr,O as Er,dA as $r,kY as Ar,aK as _r,z as kr}from"./index-DMEurr7E.js";import{m as be,a as Tt,L as Rr}from"./ColorBackground-DELE_yvu.js";import{e as xr}from"./jsonContext-sw1e6Qr2.js";import{p as Or,n as Cr}from"./project-DK1RFrrh.js";import{f as Vr}from"./writeUtils-UNPMbZhD.js";let B=class extends y{constructor(t){super(t),this.moment=null,this.fullUpdate=!1,this.validateErrorsCreated=!1,this.dirtyAreaCount=null,this.exceededTransferLimit=null,this.serviceEdits=null,this.discoveredSubnetworks=null}};r([o({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.moment=e?e.getTime():null}}}})],B.prototype,"moment",void 0),r([o({type:Boolean,json:{write:!0}})],B.prototype,"fullUpdate",void 0),r([o({type:Boolean,json:{write:!0}})],B.prototype,"validateErrorsCreated",void 0),r([o({type:Number,json:{write:!0}})],B.prototype,"dirtyAreaCount",void 0),r([o({type:Boolean,json:{write:!0}})],B.prototype,"exceededTransferLimit",void 0),r([o({type:[Object],json:{write:!0}})],B.prototype,"serviceEdits",void 0),r([o({type:[Object],json:{write:!0}})],B.prototype,"discoveredSubnetworks",void 0),B=r([d("esri.rest.networks.support.ValidateNetworkTopologyResult")],B);const Ur=B,Lr=Vt()({Pending:"job-waiting",InProgress:"job-executing",Completed:"job-succeeded"});let le=class extends Ur{constructor(t){super(t),this.statusUrl=null,this.status=null,this.submissionTime=null,this.lastUpdatedTime=null,this._timer=void 0}destroy(){clearInterval(this._timer)}async checkJobStatus(t){const i={...t,query:{f:"json"}},{data:s}=await ve(this.statusUrl,i);return this.read(s),this.editsResolver&&this.editsResolver.resolve({edits:null,addedFeatures:[],updatedFeatures:[],deletedFeatures:[],addedAttachments:[],updatedAttachments:[],deletedAttachments:[],exceededTransferLimit:!0,historicMoment:null}),this}async waitForJobCompletion(t={}){const{interval:i=1e3,statusCallback:s}=t;return new Promise((n,a)=>{this._clearTimer();const l=setInterval(()=>{this._timer||a(Ut()),this.checkJobStatus().then(p=>{const{status:u}=p;switch(this.status=u,u){case"job-succeeded":this._clearTimer(),n(this);break;case"job-waiting":case"job-executing":s&&s(this)}},p=>{this._clearTimer(),a(p)})},i);this._timer=l})}_clearTimer(){clearInterval(this._timer),this._timer=void 0}};r([o()],le.prototype,"editsResolver",void 0),r([o({type:String,json:{write:!0}})],le.prototype,"statusUrl",void 0),r([W(Lr)],le.prototype,"status",void 0),r([o({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.submissionTime=e?e.getTime():null}}}})],le.prototype,"submissionTime",void 0),r([o({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.lastUpdatedTime=e?e.getTime():null}}}})],le.prototype,"lastUpdatedTime",void 0),le=r([d("esri.networks.support.TopologyValidationJobInfo")],le);const Fr=le;async function xt(e,t){if(e==="Utility Network Layer"){const{default:i}=await N(()=>Promise.resolve().then(()=>ei),void 0);return new i({layerUrl:t})}return null}async function Pr(e){var l;let t="portalItem"in e?e:{portalItem:e};!t.portalItem||t.portalItem instanceof nt||(t={...t,portalItem:new nt(t.portalItem)});const i=t.portalItem;if(await i.load(),i.type!=="Feature Service")throw new re("portal:unknown-item-type","Unknown item type '${type}'",{type:i.type});const s=i.url,n=await ve(s,{responseType:"json",query:{f:"json"}}),a="Network Layer";if((l=n.data.type)!=null&&l.includes(a))return xt(n.data.type,s);if(n.data.layers){const p=n.data.layers.find(u=>u.type.includes(a));if(p){const u=`${s}/${p.id}`;return xt(p.type,u)}}return null}let S=class extends Lt(It){static fromPortalItem(e){return Pr(e)}constructor(e){super(e),this.id=null,this.title=null,this.layerUrl=null,this.dataElement=null,this.fullExtent=null,this.spatialReference=null,this.type=null,this.sourceJSON=null,this.gdbVersion=null,this.historicMoment=null,this._applyEditsHandler=t=>{const{serviceUrl:i,gdbVersion:s,result:n}=t,a=i===this.featureServiceUrl,l=$t(i,s,this.gdbVersion);a&&l&&n.then(p=>{it(i,s)&&(this.historicMoment=p.historicMoment)})},this._updateMomentHandler=t=>{const{serviceUrl:i,gdbVersion:s,moment:n}=t,a=i===this.featureServiceUrl,l=$t(i,s,this.gdbVersion);a&&l&&(this.historicMoment=n)},this.when().then(()=>{this.addHandles([Yt(this._applyEditsHandler),Qt(this._updateMomentHandler)])},()=>{})}initialize(){this.when().catch(e=>{Xt(e)||Ve.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})})}get datasetName(){var e;return((e=this.dataElement)==null?void 0:e.name)??null}get owner(){var e;return((e=this.dataElement)==null?void 0:e.userIdentity)??null}get schemaGeneration(){var e;return((e=this.dataElement)==null?void 0:e.schemaGeneration)??null}get parsedUrl(){return er(this.layerUrl)}get featureServiceUrl(){return At(this.parsedUrl.path).url.path}get networkServiceUrl(){return this.featureServiceUrl.replace(/\/FeatureServer/i,"/UtilityNetworkServer")}get layerId(){return At(this.parsedUrl.path).sublayer}get networkSystemLayers(){return null}async load(e){return this.addResolvingPromise(this._fetchDataElement(this.featureServiceUrl,this.layerId.toString(),e)),this.addResolvingPromise(this._fetchLayerMetaData(this.layerUrl,e)),this}getLayerIdBySourceId(e){if(this.dataElement){const t=this.dataElement.domainNetworks;for(const i of t){for(const s of i.edgeSources??[])if(s.sourceId===e)return s.layerId;for(const s of i.junctionSources??[])if(s.sourceId===e)return s.layerId}return null}return null}async queryNamedTraceConfigurations(e,t){var l;const[{queryNamedTraceConfigurations:i},{default:s}]=await Promise.all([N(()=>import("./queryNamedTraceConfigurations-BxaubaYF.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11])),N(()=>import("./QueryNamedTraceConfigurationsParameters-DKBZFa--.js"),__vite__mapDeps([12,1,2]))]),n=this.networkServiceUrl,a=s.from(e);return(l=await i(n,a,{...t}))==null?void 0:l.namedTraceConfigurations}async validateTopology(e,t){var b,I,T;if(!e.validateArea)throw new re("network:undefined-validateArea","the network must have validateArea defined in the validate network topology parameters.");const[{validateNetworkTopology:i},{default:s}]=await Promise.all([N(()=>import("./validateNetworkTopology-D3v1m5Ra.js"),__vite__mapDeps([13,1,2,3,4,5,6,7,8,9,10,11])),N(()=>import("./ValidateNetworkTopologyParameters-CAZVVwga.js"),__vite__mapDeps([14,1,2,3,4,5,6,7,8,9,10,11]))]),n=s.from(e);it(this.featureServiceUrl,this.gdbVersion||null)?(n.sessionID=_t,await kt(this.featureServiceUrl,this.gdbVersion,!0)):n.sessionID=null,n.gdbVersion=this.gdbVersion;const a=this.networkServiceUrl,l=this.featureServiceUrl,p=Rt(l,null,this.gdbVersion,!0),u=await i(a,n,{...t});if(u!=null&&u.serviceEdits){const A=[];for(const w of u.serviceEdits){const{editedFeatures:h}=w,c=h!=null&&h.spatialReference?new De(h.spatialReference):null;A.push({layerId:w.layerId,editedFeatures:{adds:((b=h==null?void 0:h.adds)==null?void 0:b.map(f=>Be(f,c)))||[],updates:((I=h==null?void 0:h.updates)==null?void 0:I.map(f=>({original:Be(f[0],c),current:Be(f[1],c)})))||[],deletes:((T=h==null?void 0:h.deletes)==null?void 0:T.map(f=>Be(f,c)))||[],spatialReference:c}})}p.resolve({edits:null,addedFeatures:[],updatedFeatures:[],deletedFeatures:[],addedAttachments:[],updatedAttachments:[],deletedAttachments:[],editedFeatures:A,exceededTransferLimit:!1,historicMoment:u.moment})}return u}async submitTopologyValidationJob(e,t){let i=null;if(!e.validateArea)throw new re("network:undefined-validateArea","the network must have validateArea defined in the validate network topology parameters.");if(!this.gdbVersion){const b=this.layerUrl.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");i=(await ve(b,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}const[{submitValidateNetworkTopologyJob:s},{default:n}]=await Promise.all([N(()=>import("./validateNetworkTopology-D3v1m5Ra.js"),__vite__mapDeps([13,1,2,3,4,5,6,7,8,9,10,11])),N(()=>import("./ValidateNetworkTopologyParameters-CAZVVwga.js"),__vite__mapDeps([14,1,2,3,4,5,6,7,8,9,10,11]))]),a=n.from(e);it(this.featureServiceUrl,this.gdbVersion||null)?(a.sessionID=_t,await kt(this.featureServiceUrl,this.gdbVersion,!0)):a.sessionID=null,a.gdbVersion=this.gdbVersion||i;const l=this.networkServiceUrl,p=this.featureServiceUrl?Rt(this.featureServiceUrl,null,this.gdbVersion,!0):void 0,u=await s(l,a,{...t});return new Fr({statusUrl:u,editsResolver:p})}async _fetchLayerMetaData(e,t){const i=await ve(e,{responseType:"json",query:{f:"json"},...t});this.sourceJSON=i.data,this.read(i.data,{origin:"service"})}async _fetchDataElement(e,t,i){if(this.dataElement)return;const s=await ve(`${e}/queryDataElements`,{responseType:"json",query:{layers:JSON.stringify([t]),f:"json"},...i}).then(n=>{var a;return(a=n.data.layerDataElements)==null?void 0:a[0]});s&&this.read(s,{origin:"service"})}};function Be(e,t){return new Ft({attributes:e.attributes,geometry:Pt({...e.geometry,spatialReference:t})})}r([o({type:String,nonNullable:!0,json:{origins:{"web-map":{read:!0,write:{isRequired:!0}},service:{read:!0}},read:!1}})],S.prototype,"id",void 0),r([o({type:String,nonNullable:!0,json:{origins:{"web-map":{read:!0,write:{isRequired:!0}},service:{read:{source:"name"}}},read:!1}})],S.prototype,"title",void 0),r([o({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"url"},write:{target:"url",isRequired:!0}}},read:!1}})],S.prototype,"layerUrl",void 0),r([o({type:Object,json:{origins:{service:{read:!0}},read:!1}})],S.prototype,"dataElement",void 0),r([o({type:tr,json:{origins:{service:{read:{source:"extent"}}},read:!1}})],S.prototype,"fullExtent",void 0),r([o({type:De,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:!1}})],S.prototype,"spatialReference",void 0),r([o({type:["utility","trace"],readOnly:!0,json:{read:!1,write:!1}})],S.prototype,"type",void 0),r([o({readOnly:!0})],S.prototype,"datasetName",null),r([o({readOnly:!0})],S.prototype,"owner",null),r([o({readOnly:!0})],S.prototype,"schemaGeneration",null),r([o({readOnly:!0})],S.prototype,"parsedUrl",null),r([o({readOnly:!0})],S.prototype,"featureServiceUrl",null),r([o({readOnly:!0})],S.prototype,"networkServiceUrl",null),r([o({readOnly:!0})],S.prototype,"layerId",null),r([o()],S.prototype,"sourceJSON",void 0),r([o({readOnly:!0})],S.prototype,"networkSystemLayers",null),r([o()],S.prototype,"gdbVersion",void 0),r([o({type:Date})],S.prototype,"historicMoment",void 0),S=r([d("esri.networks.Network")],S);const Gr=S;var X;(function(e){e[e.RTJunctionJunctionConnectivity=1]="RTJunctionJunctionConnectivity",e[e.RTAttachment=2]="RTAttachment",e[e.RTContainment=3]="RTContainment",e[e.RTJunctionEdgeConnectivity=4]="RTJunctionEdgeConnectivity",e[e.RTEdgeJunctionEdgeConnectivity=5]="RTEdgeJunctionEdgeConnectivity"})(X||(X={}));const qe=new ie({connected:"connected",upstream:"upstream",downstream:"downstream",shortestPath:"shortest-path",subnetwork:"subnetwork",subnetworkController:"subnetwork-controller",loops:"loops",isolation:"isolation"}),Qi=new ie({junctionJunctionConnectivity:"junction-junction-connectivity",connectivity:"connectivity",attachment:"attachment",containment:"containment",junctionEdgeFromConnectivity:"junction-edge-from-connectivity",junctionMidspanConnectivity:"junction-midspan-connectivity",junctionEdgeToConnectivity:"junction-edge-to-connectivity"}),Dr={connectivity:1,"junction-junction-connectivity":1,attachment:2,containment:3,"junction-edge-from-connectivity":4,"junction-midspan-connectivity":5,"junction-edge-to-connectivity":6},Xi=new ie({normal:"normal",rebuild:"rebuild",forceRebuild:"force-rebuild"});let pe=class extends rr(It){constructor(t){super(t),this.rulesCategorized={attachment:[],containment:[],connectivity:[]},this.request=ve}initialize(){}async load(t){const i=this.layer.load(t).then(()=>this._initializeRulesTable());return this.addResolvingPromise(i),this}getFeatureSQL(t,i){var b,I;const s=t.layerId.toString(),n=(b=t.fieldsIndex)==null?void 0:b.normalizeFieldName("assetGroup"),a=(I=t.fieldsIndex)==null?void 0:I.normalizeFieldName("assetType"),l=n?i.attributes[n]:null,p=a?i.attributes[a]:null,u=this.rulesHash[s];if(u){const T=u.assetGroupHash[l];if(T)return T.assetTypeHash[p]||null}return null}async _initializeRulesTable(){var n,a,l,p,u,b,I,T,A,w,h;const t={};let i;(function(c){c[c.from=0]="from",c[c.to=1]="to",c[c.via=2]="via"})(i||(i={}));const s=[{networkSourceId:"fromNetworkSource",assetGroupId:"fromAssetGroup",assetTypeId:"fromAssetType"},{networkSourceId:"toNetworkSource",assetGroupId:"toAssetGroup",assetTypeId:"toAssetType"},{networkSourceId:"viaNetworkSource",assetGroupId:"viaAssetGroup",assetTypeId:"viaAssetType"}];this.rulesCategorized={attachment:[],containment:[],connectivity:[]};for(const c of this.rules){if(c.ruleType===X.RTAttachment){this.rulesCategorized.attachment.push(c);continue}if(c.ruleType===X.RTContainment){this.rulesCategorized.containment.push(c);continue}if(c.ruleType===X.RTJunctionJunctionConnectivity){this.rulesCategorized.connectivity.push(c);continue}this.rulesCategorized.connectivity.push(c);let f=[[i.from,i.to],[i.to,i.from]];c.ruleType===X.RTEdgeJunctionEdgeConnectivity&&(f=[[i.from,i.via],[i.via,i.from],[i.to,i.via],[i.via,i.to]]);for(const O of f){const C=O.shift(),ye=O.shift();let se=!1;switch(c.ruleType){case X.RTEdgeJunctionEdgeConnectivity:se=C===i.from||C===i.to;break;case X.RTJunctionEdgeConnectivity:se=C===i.to}const ne=s[C],v=((n=c[ne.networkSourceId])==null?void 0:n.layerId.toString())??"",x=(l=(a=c[ne.assetGroupId])==null?void 0:a.assetGroupCode)==null?void 0:l.toString(),E=c[ne.assetTypeId],V=(p=E==null?void 0:E.assetTypeCode)==null?void 0:p.toString(),F=s[ye],_=((u=c[F.networkSourceId])==null?void 0:u.layerId.toString())??"",ae=(I=(b=c[F.assetGroupId])==null?void 0:b.assetGroupCode)==null?void 0:I.toString(),k=c[F.assetTypeId],M=(T=k==null?void 0:k.assetTypeCode)==null?void 0:T.toString(),K=t[v]??{assetGroupHash:{}};if(!(x&&V&&ae&&M))continue;const rt=K.assetGroupHash[x]??{assetTypeHash:{}},$=rt.assetTypeHash[V]??{};if($[_]=$[_]??{},se){$[v]=$[v]??{};const Et=`(assetgroup = ${x} AND assettype = ${V})`;$[v].anyVertex=$[v].anyVertex?`${$[v].anyVertex}`:`${Et}`,(k==null?void 0:k.connectivityPolicy)==="esriNECPEndVertex"&&($[v].endVertex=(A=$[v])!=null&&A.endVertex?`${$[v].endVertex}`:`${Et}`)}const Je=`(assetgroup = ${ae} AND assettype = ${M})`;$[_].anyVertex=(w=$[_])!=null&&w.anyVertex?`${$[_].anyVertex} OR ${Je}`:`${Je}`,(k==null?void 0:k.connectivityPolicy)==="esriNECPEndVertex"&&($[_].endVertex=(h=$[_])!=null&&h.endVertex?`${$[_].endVertex} OR ${Je}`:`${Je}`),rt.assetTypeHash[V]=$,K.assetGroupHash[x]=rt,t[v]=K}}this.rulesHash=t}};r([o({constructOnly:!0})],pe.prototype,"layer",void 0),r([o({constructOnly:!0})],pe.prototype,"rules",void 0),r([o()],pe.prototype,"rulesHash",void 0),r([o()],pe.prototype,"rulesCategorized",void 0),r([o({constructOnly:!0})],pe.prototype,"request",void 0),pe=r([d("esri.networks.RulesTable")],pe);const Jr=pe;let U=class extends y{constructor(t){super(t),this.conditionBarriers=[],this.outputConditions=[],this.functions=[],this.functionBarriers=[],this.traversabilityScope=null,this.shortestPathNetworkAttributeName=null,this.includeBarriers=null,this.validateConsistency=null,this.ignoreBarriersAtStartingPoints=null}};r([o({type:[Object],json:{write:!0}})],U.prototype,"conditionBarriers",void 0),r([o({type:[Object],json:{write:!0}})],U.prototype,"outputConditions",void 0),r([o({type:[Object],json:{write:!0}})],U.prototype,"functions",void 0),r([o({type:[Object],json:{write:!0}})],U.prototype,"functionBarriers",void 0),r([o({type:["junctions","edges","junctionsAndEdges"],json:{write:!0}})],U.prototype,"traversabilityScope",void 0),r([o({type:String,json:{write:!0}})],U.prototype,"shortestPathNetworkAttributeName",void 0),r([o({type:Boolean,json:{write:!0}})],U.prototype,"includeBarriers",void 0),r([o({type:Boolean,json:{write:!0}})],U.prototype,"validateConsistency",void 0),r([o({type:Boolean,json:{write:!0}})],U.prototype,"ignoreBarriersAtStartingPoints",void 0),U=r([d("esri.networks.support.TraceConfiguration")],U);const jt=U;let g=class extends jt{constructor(t){super(t),this.filterBarriers=[],this.arcadeExpressionBarrier=null,this.domainNetworkName=null,this.filterBitsetNetworkAttributeName=null,this.filterFunctionBarriers=[],this.filterScope=null,this.includeContainers=null,this.includeContent=null,this.includeIsolated=null,this.includeStructures=null,this.allowIndeterminateFlow=null,this.includeUpToFirstSpatialContainer=null,this.nearestNeighbor=null,this.outputFilterCategories=[],this.outputFilters=[],this.propagators=[],this.subnetworkName=null,this.targetTierName=null,this.diagramTemplateName=null,this.tierName=null,this.validateLocatability=null}};r([o({type:[Object],json:{write:!0}})],g.prototype,"filterBarriers",void 0),r([o({type:String,json:{write:!0}})],g.prototype,"arcadeExpressionBarrier",void 0),r([o({type:String,json:{write:!0}})],g.prototype,"domainNetworkName",void 0),r([o({type:String,json:{write:!0}})],g.prototype,"filterBitsetNetworkAttributeName",void 0),r([o({type:[Object],json:{write:!0}})],g.prototype,"filterFunctionBarriers",void 0),r([o({type:["junctions","edges","junctionsAndEdges"],json:{write:!0}})],g.prototype,"filterScope",void 0),r([o({type:Boolean,json:{write:!0}})],g.prototype,"includeContainers",void 0),r([o({type:Boolean,json:{write:!0}})],g.prototype,"includeContent",void 0),r([o({type:Boolean,json:{write:!0}})],g.prototype,"includeIsolated",void 0),r([o({type:Boolean,json:{write:!0}})],g.prototype,"includeStructures",void 0),r([o({type:Boolean,json:{write:!0}})],g.prototype,"allowIndeterminateFlow",void 0),r([o({type:Boolean,json:{write:!0}})],g.prototype,"includeUpToFirstSpatialContainer",void 0),r([o({type:Object,json:{write:!0}})],g.prototype,"nearestNeighbor",void 0),r([o({type:[Object],json:{write:!0}})],g.prototype,"outputFilterCategories",void 0),r([o({type:[Object],json:{write:!0}})],g.prototype,"outputFilters",void 0),r([o({type:[Object],json:{write:!0}})],g.prototype,"propagators",void 0),r([o({type:String,json:{write:!0}})],g.prototype,"subnetworkName",void 0),r([o({type:String,json:{write:!0}})],g.prototype,"targetTierName",void 0),r([o({type:String,json:{write:!0}})],g.prototype,"diagramTemplateName",void 0),r([o({type:String,json:{write:!0}})],g.prototype,"tierName",void 0),r([o({type:Boolean,json:{write:!0}})],g.prototype,"validateLocatability",void 0),g=r([d("esri.networks.support.UNTraceConfiguration")],g);const Mr=g;let R=class extends ir{constructor(t){super(t),this.globalId=null,this.title=null,this.traceConfiguration=null,this.creationDate=null,this.creator=null,this.description=null,this.minStartingPoints=null,this.resultTypes=[],this.tags=[],this.traceType=null}readTraceConfiguration(t,i){return t.tierName!==void 0?Mr.fromJSON(t):jt.fromJSON(t)}};r([o({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"id"},write:{target:"id",isRequired:!0}},service:{read:{source:"globalId"},write:{target:"globalId",isRequired:!0}}},read:!1}})],R.prototype,"globalId",void 0),r([o({type:String,nonNullable:!0,json:{origins:{"web-map":{read:{source:"title"},write:{target:"title",isRequired:!0}},service:{read:{source:"name"},write:{target:"name",isRequired:!0}}},read:!1}})],R.prototype,"title",void 0),r([o({type:jt,json:{origins:{service:{read:!0,write:!0}},read:!1}})],R.prototype,"traceConfiguration",void 0),r([te("service","traceConfiguration")],R.prototype,"readTraceConfiguration",null),r([o({type:Date,json:{origins:{service:{read:!0,write:!0}},read:!1}})],R.prototype,"creationDate",void 0),r([o({type:String,json:{origins:{service:{read:!0,write:!0}},read:!1}})],R.prototype,"creator",void 0),r([o({type:String,json:{origins:{service:{read:!0,write:!0}},read:!1}})],R.prototype,"description",void 0),r([o({type:["none","one","many"],json:{origins:{service:{read:{source:"minNumStartingPoints"},write:{target:"minNumStartingPoints"}}},read:!1}})],R.prototype,"minStartingPoints",void 0),r([o({json:{origins:{service:{read:!0,write:!0}},read:!1}})],R.prototype,"resultTypes",void 0),r([o({type:[String],json:{origins:{service:{read:!0,write:!0}},read:!1}})],R.prototype,"tags",void 0),r([o({type:qe.apiValues,json:{type:qe.jsonValues,origins:{service:{read:qe.read,write:qe.write}},read:!1}})],R.prototype,"traceType",void 0),R=r([d("esri.networks.support.NamedTraceConfiguration")],R);const Br=R;let P=class extends Gt{constructor(t){super(t),this.rulesTableId=null,this.rulesTableUrl=null,this.subnetworksTableId=null,this.subnetworksTableUrl=null,this.dirtyAreasLayerId=null,this.dirtyAreasLayerUrl=null,this.associationsTableId=null,this.associationsTableUrl=null}};r([o({constructOnly:!0})],P.prototype,"rulesTableId",void 0),r([o({constructOnly:!0})],P.prototype,"rulesTableUrl",void 0),r([o({constructOnly:!0})],P.prototype,"subnetworksTableId",void 0),r([o({constructOnly:!0})],P.prototype,"subnetworksTableUrl",void 0),r([o({constructOnly:!0})],P.prototype,"dirtyAreasLayerId",void 0),r([o({constructOnly:!0})],P.prototype,"dirtyAreasLayerUrl",void 0),r([o({constructOnly:!0})],P.prototype,"associationsTableId",void 0),r([o({constructOnly:!0})],P.prototype,"associationsTableUrl",void 0),P=r([d("esri.networks.support.NetworkSystemLayers")],P);const qr=P;let Se=class extends y{constructor(t){super(t),this.id=null,this.name=null}};r([o({type:Number,json:{read:{source:"terminalId"},write:{target:"terminalId"}}})],Se.prototype,"id",void 0),r([o({type:String,json:{read:{source:"terminalName"},write:{target:"terminalName"}}})],Se.prototype,"name",void 0),r([o({type:Boolean,json:{write:!0}})],Se.prototype,"isUpstreamTerminal",void 0),Se=r([d("esri.networks.support.Terminal")],Se);const zr=Se,ze=new ie({esriUNTMBidirectional:"bidirectional",esriUNTMDirectional:"directional"});let ue=class extends y{constructor(t){super(t),this.defaultConfiguration=null,this.id=null,this.name=null,this.terminals=[],this.traversabilityModel=null}};r([o({type:String,json:{write:!0}})],ue.prototype,"defaultConfiguration",void 0),r([o({type:Number,json:{read:{source:"terminalConfigurationId"},write:{target:"terminalConfigurationId"}}})],ue.prototype,"id",void 0),r([o({type:String,json:{read:{source:"terminalConfigurationName"},write:{target:"terminalConfigurationName"}}})],ue.prototype,"name",void 0),r([o({type:[zr],json:{write:!0}})],ue.prototype,"terminals",void 0),r([o({type:ze.apiValues,json:{type:ze.jsonValues,read:ze.read,write:ze.write}})],ue.prototype,"traversabilityModel",void 0),ue=r([d("esri.networks.support.TerminalConfiguration")],ue);const Ot=ue;let Ie=class extends y{constructor(t){super(t),this.line=null,this.multipoint=null,this.polygon=null}};r([o({type:or,json:{write:!0},readOnly:!0})],Ie.prototype,"line",void 0),r([o({type:sr,json:{read:{source:"point"},write:{target:"point"}},readOnly:!0})],Ie.prototype,"multipoint",void 0),r([o({type:nr,json:{write:!0},readOnly:!0})],Ie.prototype,"polygon",void 0),Ie=r([d("esri.rest.networks.support.AggregatedGeometry")],Ie);const Hr=Ie;let Te=class extends y{constructor(t){super(t),this.functionType=null,this.networkAttributeName=null,this.result=null}};r([o({type:["add","subtract","average","count","min","max"],json:{write:!0},readOnly:!0})],Te.prototype,"functionType",void 0),r([o({type:String,json:{write:!0},readOnly:!0})],Te.prototype,"networkAttributeName",void 0),r([o({type:Number,json:{write:!0},readOnly:!0})],Te.prototype,"result",void 0),Te=r([d("esri.rest.networks.support.FunctionResult")],Te);const Wr=Te;let G=class extends y{constructor(t){super(t),this.assetGroupCode=null,this.assetTypeCode=null,this.globalId=null,this.networkSourceId=null,this.objectId=null,this.positionFrom=null,this.positionTo=null,this.terminalId=null}};r([o({type:Number,json:{write:!0}})],G.prototype,"assetGroupCode",void 0),r([o({type:Number,json:{write:!0}})],G.prototype,"assetTypeCode",void 0),r([o({type:String,json:{write:!0}})],G.prototype,"globalId",void 0),r([o({type:Number,json:{write:!0}})],G.prototype,"networkSourceId",void 0),r([o({type:Number,json:{write:!0}})],G.prototype,"objectId",void 0),r([o({type:Number,json:{write:!0}})],G.prototype,"positionFrom",void 0),r([o({type:Number,json:{write:!0}})],G.prototype,"positionTo",void 0),r([o({type:Number,json:{write:!0}})],G.prototype,"terminalId",void 0),G=r([d("esri.rest.networks.support.NetworkElement")],G);const Zr=G;let Y=class extends y{constructor(t){super(t),this.aggregatedGeometry=null,this.elements=null,this.globalFunctionResults=null,this.kFeaturesForKNNFound=!1,this.startingPointsIgnored=!1,this.warnings=null}};r([o({type:Hr,json:{write:!0},readOnly:!0})],Y.prototype,"aggregatedGeometry",void 0),r([o({type:[Zr],json:{write:!0},readOnly:!0})],Y.prototype,"elements",void 0),r([o({type:[Wr],json:{write:!0},readOnly:!0})],Y.prototype,"globalFunctionResults",void 0),r([o({type:Boolean,json:{write:!0},readOnly:!0})],Y.prototype,"kFeaturesForKNNFound",void 0),r([o({type:Boolean,json:{write:!0},readOnly:!0})],Y.prototype,"startingPointsIgnored",void 0),r([o({type:[String],json:{write:!0},readOnly:!0})],Y.prototype,"warnings",void 0),Y=r([d("esri.rest.networks.support.TraceResult")],Y);const Kr=Y,Yr=Vt()({Pending:"job-waiting",InProgress:"job-executing",Completed:"job-succeeded"});let me=class extends Kr{constructor(t){super(t),this.statusUrl=null,this.status=null,this.submissionTime=null,this.lastUpdatedTime=null,this._timer=void 0}destroy(){clearInterval(this._timer)}async checkJobStatus(t){const i={...t,query:{f:"json"}},{data:s}=await ve(this.statusUrl,i),n=s.traceResults?{...s.traceResults,...s}:s;return this.read(n),this}async waitForJobCompletion(t={}){const{interval:i=1e3,statusCallback:s}=t;return new Promise((n,a)=>{this._clearTimer();const l=setInterval(()=>{this._timer||a(Ut()),this.checkJobStatus().then(p=>{const{status:u}=p;switch(this.status=u,u){case"job-succeeded":this._clearTimer(),n(this);break;case"job-waiting":case"job-executing":s&&s(this)}},p=>{this._clearTimer(),a(p)})},i);this._timer=l})}_clearTimer(){clearInterval(this._timer),this._timer=void 0}};r([o({type:String,json:{write:!0}})],me.prototype,"statusUrl",void 0),r([W(Yr)],me.prototype,"status",void 0),r([o({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.submissionTime=e?e.getTime():null}}}})],me.prototype,"submissionTime",void 0),r([o({type:Date,json:{type:Number,write:{writer:(e,t)=>{t.lastUpdatedTime=e?e.getTime():null}}}})],me.prototype,"lastUpdatedTime",void 0),me=r([d("esri.networks.support.TraceJobInfo")],me);const Qr=me;let Q=class extends Gr{constructor(t){super(t),this.sharedNamedTraceConfigurations=[],this.type="utility"}get serviceTerritoryFeatureLayerId(){var t;return((t=this.dataElement)==null?void 0:t.serviceTerritoryFeatureLayerId)??null}get networkSystemLayers(){var t,i,s,n,a,l,p,u;return new qr({rulesTableId:(t=this.sourceJSON)==null?void 0:t.systemLayers.rulesTableId,rulesTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${(i=this.sourceJSON)==null?void 0:i.systemLayers.rulesTableId}`:null,subnetworksTableId:(s=this.sourceJSON)==null?void 0:s.systemLayers.subnetworksTableId,subnetworksTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${(n=this.sourceJSON)==null?void 0:n.systemLayers.subnetworksTableId}`:null,dirtyAreasLayerId:(a=this.sourceJSON)==null?void 0:a.systemLayers.dirtyAreasLayerId,dirtyAreasLayerUrl:this.sourceJSON?`${this.featureServiceUrl}/${(l=this.sourceJSON)==null?void 0:l.systemLayers.dirtyAreasLayerId}`:null,associationsTableId:(p=this.sourceJSON)==null?void 0:p.systemLayers.associationsTableId,associationsTableUrl:this.sourceJSON?`${this.featureServiceUrl}/${(u=this.sourceJSON)==null?void 0:u.systemLayers.associationsTableId}`:null})}get terminalConfigurations(){var t;return((t=this.dataElement)==null?void 0:t.terminalConfigurations.map(i=>Ot.fromJSON(i)))||[]}get domainNetworkNames(){var t;return((t=this.dataElement)==null?void 0:t.domainNetworks.map(i=>i.domainNetworkName))||[]}get _utilityLayerList(){var i,s;const t=new Set;return(s=(i=this.dataElement)==null?void 0:i.domainNetworks)==null||s.map(n=>{n.edgeSources.map(a=>{t.add(a.layerId)}),n.junctionSources.map(a=>{t.add(a.layerId)})}),t}async load(t){return this.addResolvingPromise(super.load(t)),this.addResolvingPromise(this._loadNamedTraceConfigurationsFromNetwork(t)),this}getTerminalConfiguration(t){var b,I,T,A;let i=null,s=null;const n=t.layer;let a=null;if((n==null?void 0:n.type)==="feature"){if(a=n.layerId,a===null)return null}else if((n==null?void 0:n.type)!=="subtype-sublayer"||(a=((b=n==null?void 0:n.parent)==null?void 0:b.layerId)??null,a===null))return null;const l=t.attributes;if(l==null)return null;for(const w of Object.keys(l))w.toUpperCase()==="ASSETGROUP"&&(i=t.getAttribute(w)),w.toUpperCase()==="ASSETTYPE"&&(s=t.getAttribute(w));if(!this.dataElement)return null;let p=null;const u=this.dataElement.domainNetworks;for(const w of u){const h=(I=w.junctionSources)==null?void 0:I.find(c=>c.layerId===a);if(h){const c=(T=h.assetGroups)==null?void 0:T.find(f=>f.assetGroupCode===i);if(c){const f=(A=c.assetTypes)==null?void 0:A.find(O=>O.assetTypeCode===s);if(f){p=f.terminalConfigurationId;break}}}}if(p!=null){const w=this.dataElement.terminalConfigurations,h=w==null?void 0:w.find(c=>c.terminalConfigurationId===p);return h?Ot.fromJSON(h):null}return null}getTierNames(t){var s;const i=(s=this.dataElement)==null?void 0:s.domainNetworks.find(n=>n.domainNetworkName===t);return(i==null?void 0:i.tiers.map(n=>n.name))||[]}async getRulesTable(){return this._sharedRulesTable||(this._sharedRulesTable=this._createRulesTable()),await this._sharedRulesTable}isUtilityLayer(t){var i;return this._utilityLayerList.has(t.layerId)&&(((i=t.url)==null?void 0:i.startsWith(this.featureServiceUrl))??!1)}async queryAssociations(t){const[{queryAssociations:i},{default:s}]=await Promise.all([N(()=>import("./queryAssociations-CA0ETstd.js"),__vite__mapDeps([15,1,2,16,3,4,5,6,7,8,9,10,11])),N(()=>import("./QueryAssociationsParameters-CCo4dLCl.js"),__vite__mapDeps([17,1,2,3,4,5,6,7,8,9,10,11]))]),n=s.from(t);return n.gdbVersion=this.gdbVersion,n.moment=this.historicMoment,(await i(this.networkServiceUrl,n)).associations}async synthesizeAssociationGeometries(t){const[{synthesizeAssociationGeometries:i},{default:s}]=await Promise.all([N(()=>import("./synthesizeAssociationGeometries-DW2PN1Dh.js"),__vite__mapDeps([18,1,2,16,3,4,5,6,7,8,9,10,11])),N(()=>import("./SynthesizeAssociationGeometriesParameters-CHM1bs0z.js"),__vite__mapDeps([19,1,2]))]),n=s.from(t);return n.gdbVersion=this.gdbVersion,n.moment=this.historicMoment,i(this.networkServiceUrl,n)}async trace(t){const[{trace:i},{default:s}]=await Promise.all([N(()=>import("./trace-BiX_kHFu.js"),__vite__mapDeps([20,1,2,3,4,5,6,7,8,9,10,11])),N(()=>import("./TraceParameters-kP7Hjqyp.js"),__vite__mapDeps([21,1,2,3,4,5,6,7,8,9,10,11]))]),n=s.from(t);return n.gdbVersion=this.gdbVersion,n.moment=this.historicMoment,i(this.networkServiceUrl,n)}async submitTraceJob(t){const[{submitTraceJob:i},{default:s}]=await Promise.all([N(()=>import("./trace-BiX_kHFu.js"),__vite__mapDeps([20,1,2,3,4,5,6,7,8,9,10,11])),N(()=>import("./TraceParameters-kP7Hjqyp.js"),__vite__mapDeps([21,1,2,3,4,5,6,7,8,9,10,11]))]),n=s.from(t);n.gdbVersion=this.gdbVersion,n.moment=this.historicMoment;const a=await i(this.networkServiceUrl,n);return new Qr({statusUrl:a})}async canAddAssociation(t){const i=await this.getRulesTable();if(!i)return!1;await i.load();const s=(a,l)=>a?a.terminalId===1?!(l!=null&&l.terminalId)||(l==null?void 0:l.terminalId)===a.terminalId:a.terminalId===(l==null?void 0:l.terminalId):!(l!=null&&l.terminalId),n=(a,l)=>{var p,u,b,I,T,A,w,h,c,f,O,C;return((p=a.fromNetworkSource)==null?void 0:p.sourceId)===((u=l.fromNetworkElement)==null?void 0:u.networkSourceId)&&((b=a.toNetworkSource)==null?void 0:b.sourceId)===((I=l.toNetworkElement)==null?void 0:I.networkSourceId)&&((T=a.fromAssetGroup)==null?void 0:T.assetGroupCode)===((A=l.fromNetworkElement)==null?void 0:A.assetGroupCode)&&((w=a.fromAssetType)==null?void 0:w.assetTypeCode)===((h=l.fromNetworkElement)==null?void 0:h.assetTypeCode)&&((c=a.toAssetGroup)==null?void 0:c.assetGroupCode)===((f=l.toNetworkElement)==null?void 0:f.assetGroupCode)&&((O=a.toAssetType)==null?void 0:O.assetTypeCode)===((C=l.toNetworkElement)==null?void 0:C.assetTypeCode)&&s(a.fromTerminal,l.fromNetworkElement)&&s(a.toTerminal,l.toNetworkElement)};return t.associationType==="containment"?i.rulesCategorized.containment.some(a=>n(a,t)):t.associationType==="attachment"?i.rulesCategorized.attachment.some(a=>n(a,t)):i.rulesCategorized.connectivity.some(a=>{var l,p,u,b,I,T,A,w,h,c,f,O,C,ye,se,ne,v,x,E,V,F,_,ae,k;return a.viaNetworkSource?((l=a.fromNetworkSource)==null?void 0:l.sourceId)===((p=t.fromNetworkElement)==null?void 0:p.networkSourceId)&&((u=a.viaNetworkSource)==null?void 0:u.sourceId)===((b=t.toNetworkElement)==null?void 0:b.networkSourceId)&&((I=a.fromAssetGroup)==null?void 0:I.assetGroupCode)===((T=t.fromNetworkElement)==null?void 0:T.assetGroupCode)&&((A=a.fromAssetType)==null?void 0:A.assetTypeCode)===((w=t.fromNetworkElement)==null?void 0:w.assetTypeCode)&&((h=a.viaAssetGroup)==null?void 0:h.assetGroupCode)===((c=t.toNetworkElement)==null?void 0:c.assetGroupCode)&&((f=a.viaAssetType)==null?void 0:f.assetTypeCode)===((O=t.toNetworkElement)==null?void 0:O.assetTypeCode)&&s(a.fromTerminal,t.fromNetworkElement)&&s(a.viaTerminal,t.toNetworkElement)||((C=a.viaNetworkSource)==null?void 0:C.sourceId)===((ye=t.fromNetworkElement)==null?void 0:ye.networkSourceId)&&((se=a.toNetworkSource)==null?void 0:se.sourceId)===((ne=t.toNetworkElement)==null?void 0:ne.networkSourceId)&&((v=a.viaAssetGroup)==null?void 0:v.assetGroupCode)===((x=t.fromNetworkElement)==null?void 0:x.assetGroupCode)&&((E=a.viaAssetType)==null?void 0:E.assetTypeCode)===((V=t.fromNetworkElement)==null?void 0:V.assetTypeCode)&&((F=a.toAssetGroup)==null?void 0:F.assetGroupCode)===((_=t.toNetworkElement)==null?void 0:_.assetGroupCode)&&((ae=a.toAssetType)==null?void 0:ae.assetTypeCode)===((k=t.toNetworkElement)==null?void 0:k.assetTypeCode)&&s(a.viaTerminal,t.fromNetworkElement)&&s(a.toTerminal,t.toNetworkElement):n(a,t)})}generateAddAssociations(t){return{addFeatures:t.map(i=>{var s,n,a,l,p,u;return new Ft({attributes:{fromnetworksourceid:(s=i.fromNetworkElement)==null?void 0:s.networkSourceId,fromglobalid:(n=i.fromNetworkElement)==null?void 0:n.globalId,fromterminalid:(a=i.fromNetworkElement)==null?void 0:a.terminalId,tonetworksourceid:(l=i.toNetworkElement)==null?void 0:l.networkSourceId,toglobalid:(p=i.toNetworkElement)==null?void 0:p.globalId,toterminalid:(u=i.toNetworkElement)==null?void 0:u.terminalId,associationtype:Dr[i.associationType],iscontentvisible:i.isContentVisible?1:0,percentalong:i.percentAlong,globalid:i.globalId}})}),id:this.networkSystemLayers.associationsTableId,identifierFields:{globalIdField:"globalid",objectIdField:"objectid"}}}generateDeleteAssociations(t){return{deleteFeatures:t.map(i=>({globalId:i.globalId})),id:this.networkSystemLayers.associationsTableId,identifierFields:{globalIdField:"globalid",objectIdField:"objectid"}}}async _loadNamedTraceConfigurationsFromNetwork(t){var n;if(((n=this.sharedNamedTraceConfigurations)==null?void 0:n.length)===0)return;const i=this.sharedNamedTraceConfigurations.map(a=>a.globalId),s=await this.queryNamedTraceConfigurations({globalIds:i},t);for(const a of this.sharedNamedTraceConfigurations){const l=s==null?void 0:s.find(p=>p.globalId===a.globalId);if(l){const p=l.write({},{origin:"service"});a.read(p,{origin:"service"})}}}async _createRulesTable(){var l;const t=this.networkSystemLayers.rulesTableUrl,i=new ar({url:t});await i.load();const s=(l=this.dataElement)==null?void 0:l.domainNetworks;if(!s)return null;const n=s.flatMap(p=>[...p.edgeSources||[],...p.junctionSources||[]]),a=(await Xr(i)).map(p=>this._hydrateRuleInfo(i,n,p));return new Jr({layer:i,rules:a})}_hydrateRuleInfo(t,i,s){const n=t.fieldsIndex,a=n.get("RULETYPE"),l=n.get("CREATIONDATE"),p=n.get("FROMNETWORKSOURCEID"),u=n.get("FROMASSETGROUP"),b=n.get("FROMASSETTYPE"),I=n.get("FROMTERMINALID"),T=n.get("TONETWORKSOURCEID"),A=n.get("TOASSETGROUP"),w=n.get("TOASSETTYPE"),h=n.get("TOTERMINALID"),c=n.get("VIANETWORKSOURCEID"),f=n.get("VIAASSETGROUP"),O=n.get("VIAASSETTYPE"),C=n.get("VIATERMINALID"),ye=s.attributes[a.name],se=new Date(s.attributes[l.name]),ne=[{networkSourceId:s.attributes[p.name],assetGroupId:s.attributes[u.name],assetTypeId:s.attributes[b.name],terminalId:s.attributes[I.name]},{networkSourceId:s.attributes[T.name],assetGroupId:s.attributes[A.name],assetTypeId:s.attributes[w.name],terminalId:s.attributes[h.name]},{networkSourceId:s.attributes[c.name],assetGroupId:s.attributes[f.name],assetTypeId:s.attributes[O.name],terminalId:s.attributes[C.name]}];let v;(function(E){E[E.from=0]="from",E[E.to=1]="to",E[E.via=2]="via"})(v||(v={}));const x={ruleType:ye,creationDate:se};for(const E of[v.from,v.to,v.via]){if(ye!==X.RTEdgeJunctionEdgeConnectivity&&E===v.via)continue;const V=ne[E],F=i.find(K=>K.sourceId===V.networkSourceId),_=F==null?void 0:F.assetGroups.find(K=>K.assetGroupCode===V.assetGroupId),ae=_==null?void 0:_.assetTypes.find(K=>K.assetTypeCode===V.assetTypeId),k=this._getTerminal(ae,V);let M="";switch(E){case v.from:M="from";break;case v.to:M="to";break;case v.via:M="via"}x[`${M}NetworkSource`]=F,x[`${M}AssetGroup`]=_,x[`${M}AssetType`]=ae,x[`${M}Terminal`]=k==null?void 0:k.toJSON()}return x}_getTerminal(t,i){var a,l;const s=t==null?void 0:t.terminalConfigurationId,n=(a=this.terminalConfigurations)==null?void 0:a.find(p=>p.id===s);return((l=n==null?void 0:n.terminals)==null?void 0:l.find(p=>p.id===i.terminalId))??null}};async function Xr(e){const t=new lr({where:"1=1",outFields:["*"]});return(await pr(e,t)).features}r([o({type:[Br],json:{origins:{"web-map":{read:{source:"traceConfigurations"},write:{target:"traceConfigurations"}},service:{read:{source:"traceConfigurations"}}},read:!1}})],Q.prototype,"sharedNamedTraceConfigurations",void 0),r([o({type:["utility"],readOnly:!0,json:{read:!1,write:!1}})],Q.prototype,"type",void 0),r([o({readOnly:!0})],Q.prototype,"serviceTerritoryFeatureLayerId",null),r([o({readOnly:!0})],Q.prototype,"networkSystemLayers",null),r([o({readOnly:!0})],Q.prototype,"terminalConfigurations",null),r([o({readOnly:!0})],Q.prototype,"domainNetworkNames",null),Q=r([d("esri.networks.UtilityNetwork")],Q);const Bt=Q,ei=Object.freeze(Object.defineProperty({__proto__:null,default:Bt},Symbol.toStringTag,{value:"Module"}));let de=class extends y{constructor(t){super(t),this.facilityIdField=null,this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};r([o({type:String,json:{write:!0}})],de.prototype,"facilityIdField",void 0),r([o({type:String,json:{write:!0}})],de.prototype,"layerId",void 0),r([o({type:String,json:{write:!0}})],de.prototype,"nameField",void 0),r([o({type:String,json:{write:!0}})],de.prototype,"siteIdField",void 0),r([o({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],de.prototype,"sublayerId",void 0),de=r([d("esri.layers.support.FacilityLayerInfo")],de);const ti=de;let D=class extends y{constructor(t){super(t),this.facilityIdField=null,this.layerId=null,this.levelIdField=null,this.levelNumberField=null,this.longNameField=null,this.shortNameField=null,this.sublayerId=null,this.verticalOrderField=null}};r([o({type:String,json:{write:!0}})],D.prototype,"facilityIdField",void 0),r([o({type:String,json:{write:!0}})],D.prototype,"layerId",void 0),r([o({type:String,json:{write:!0}})],D.prototype,"levelIdField",void 0),r([o({type:String,json:{write:!0}})],D.prototype,"levelNumberField",void 0),r([o({type:String,json:{write:!0}})],D.prototype,"longNameField",void 0),r([o({type:String,json:{write:!0}})],D.prototype,"shortNameField",void 0),r([o({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],D.prototype,"sublayerId",void 0),r([o({type:String,json:{write:!0}})],D.prototype,"verticalOrderField",void 0),D=r([d("esri.layers.support.LevelLayerInfo")],D);const ri=D;let he=class extends y{constructor(t){super(t),this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};r([o({type:String,json:{write:!0}})],he.prototype,"layerId",void 0),r([o({type:String,json:{write:!0}})],he.prototype,"nameField",void 0),r([o({type:String,json:{write:!0}})],he.prototype,"siteIdField",void 0),r([o({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],he.prototype,"sublayerId",void 0),he=r([d("esri.layers.support.SiteLayerInfo")],he);const ii=he;let je=class extends y{constructor(t){super(t),this.levelLayer=null,this.facilityLayer=null,this.siteLayer=null}};r([o({type:ri,json:{write:!0}})],je.prototype,"levelLayer",void 0),r([o({type:ti,json:{write:!0}})],je.prototype,"facilityLayer",void 0),r([o({type:ii,json:{write:!0}})],je.prototype,"siteLayer",void 0),je=r([d("esri.support.MapFloorInfo")],je);const oi=je;let Ne=class extends oe(y){constructor(t){super(t),this.expression=null,this.returnType="string",this.title=null}};r([o({type:String,json:{write:{isRequired:!0}}})],Ne.prototype,"expression",void 0),r([o({type:["number","string"],json:{write:!0}})],Ne.prototype,"returnType",void 0),r([o({type:String,json:{write:!0}})],Ne.prototype,"title",void 0),Ne=r([d("esri.webdoc.geotriggersInfo.ExpressionInfo")],Ne);const qt=Ne,He=new ie({deviceLocation:"device-location"});let Ue=class extends oe(y){constructor(t){super(t),this.filterExpression=null,this.type="device-location"}};r([o({type:qt,json:{write:!0}})],Ue.prototype,"filterExpression",void 0),r([o({type:He.apiValues,readOnly:!0,json:{type:He.jsonValues,read:He.read,write:He.write}})],Ue.prototype,"type",void 0),Ue=r([d("esri.webdoc.geotriggersInfo.DeviceLocationFeed")],Ue);const si=Ue;let Le=class extends oe(y){constructor(t){super(t),this.geometry=null,this.where=null}};r([o({types:ur,json:{read:Pt,write:!0}})],Le.prototype,"geometry",void 0),r([o({type:String,json:{write:!0}})],Le.prototype,"where",void 0),Le=r([d("esri.webdoc.geotriggersInfo.FeatureFilter")],Le);const ni=Le;let Ee=class extends oe(y){constructor(t){super(t),this.layerId=null,this.layerUrl=null,this.type="feature-layer"}};r([o({type:String,json:{write:{overridePolicy(){return{isRequired:this.layerUrl===null}}}}})],Ee.prototype,"layerId",void 0),r([o({type:String,json:{write:{overridePolicy(){return{isRequired:this.layerId===null}}}}})],Ee.prototype,"layerUrl",void 0),r([W({featureLayer:"feature-layer"},{readOnly:!0})],Ee.prototype,"type",void 0),Ee=r([d("esri.webdoc.geotriggersInfo.FeatureLayerSource")],Ee);const ai=Ee;let we=class extends oe(y){constructor(t){super(t),this.fenceSource=null,this.filter=null,this.bufferDistance=null,this.type="features"}};r([o({type:ai,json:{write:{isRequired:!0}}})],we.prototype,"fenceSource",void 0),r([o({type:ni,json:{write:!0}})],we.prototype,"filter",void 0),r([o({type:Number,json:{write:!0}})],we.prototype,"bufferDistance",void 0),r([W({features:"features"},{readOnly:!0})],we.prototype,"type",void 0),we=r([d("esri.webdoc.geotriggersInfo.FeatureFenceParameters")],we);const li=we;let Ye=class extends oe(y){constructor(t){super(t),this.type="fence"}};r([W({fence:"fence"},{readOnly:!0})],Ye.prototype,"type",void 0),Ye=r([d("esri.webdoc.geotriggersInfo.Geotrigger")],Ye);const zt=Ye;let Fe=class extends oe(y){constructor(t){super(t),this.expressionInfo=null,this.requestedActions=null}};r([o({type:qt,json:{write:!0}})],Fe.prototype,"expressionInfo",void 0),r([o({type:[String],json:{write:!0}})],Fe.prototype,"requestedActions",void 0),Fe=r([d("esri.webdoc.geotriggersInfo.GeotriggerNotificationOptions")],Fe);const pi=Fe,ui=new ie({enterContainsAndExitDoesNotContain:"enter-contains-and-exit-does-not-contain",enterContainsAndExitDoesNotIntersect:"enter-contains-and-exit-does-not-intersect",enterIntersectsAndExitDoesNotIntersect:"enter-intersects-and-exit-does-not-intersect"}),di=new ie({useGeometry:"use-geometry",useGeometryWithAccuracy:"use-geometry-with-accuracy"}),We=new ie({enter:"enter",enterOrExit:"enter-or-exit",exit:"exit"});let J=class extends zt{constructor(t){super(t),this.enterExitRule="enter-contains-and-exit-does-not-intersect",this.feed=null,this.feedAccuracyMode="use-geometry",this.fenceNotificationRule=null,this.fenceParameters=null,this.name=null,this.notificationOptions=null,this.type="fence"}};r([W(ui)],J.prototype,"enterExitRule",void 0),r([o({type:si,json:{write:{isRequired:!0}}})],J.prototype,"feed",void 0),r([W(di)],J.prototype,"feedAccuracyMode",void 0),r([o({type:We.apiValues,json:{type:We.jsonValues,read:We.read,write:{writer:We.write,isRequired:!0}}})],J.prototype,"fenceNotificationRule",void 0),r([o({type:li,json:{write:{isRequired:!0}}})],J.prototype,"fenceParameters",void 0),r([o({type:String,json:{write:!0}})],J.prototype,"name",void 0),r([o({type:pi,json:{write:!0}})],J.prototype,"notificationOptions",void 0),r([W({fence:"fence"},{readOnly:!0})],J.prototype,"type",void 0),J=r([d("esri.webdoc.geotriggersInfo.FenceGeotrigger")],J);const ci=J,yi={base:zt,key:"type",typeMap:{fence:ci}};let Qe=class extends oe(y){constructor(t){super(t),this.geotriggers=null}};r([o({types:[yi],json:{write:{isRequired:!0}}})],Qe.prototype,"geotriggers",void 0),Qe=r([d("esri.webdoc.GeotriggersInfo")],Qe);const mi=Qe;var at;let $e=at=class extends y{constructor(e){super(e),this.activeRange=null,this.currentRangeExtent=null,this.fullRangeExtent=null}clone(){return new at(Z({activeRange:this.activeRange,currentRangeExtent:this.currentRangeExtent,fullRangeExtent:this.fullRangeExtent}))}};r([o({type:String,nonNullable:!0,json:{read:{source:"activeRangeName"},write:{target:"activeRangeName",isRequired:!0}}})],$e.prototype,"activeRange",void 0),r([o({type:[Number],json:{write:!0}})],$e.prototype,"currentRangeExtent",void 0),r([o({type:[Number],json:{write:!0}})],$e.prototype,"fullRangeExtent",void 0),$e=at=r([d("esri.webdoc.RangeInfo")],$e);const Nt=$e;var lt;let q=lt=class extends y{constructor(e){super(e),this.enabled=!1,this.longNames=!1,this.minimized=!1,this.pinnedLevels=!1,this.site=null,this.facility=null,this.level=null}clone(){return new lt(Z({enabled:this.enabled,longNames:this.longNames,minimized:this.minimized,pinnedLevels:this.pinnedLevels,site:this.site,facility:this.facility,level:this.level}))}};r([o({type:Boolean,json:{read:{source:"enabled"},write:{target:"enabled"}}})],q.prototype,"enabled",void 0),r([o({type:Boolean,json:{read:{source:"longNames"},write:{target:"longNames"}}})],q.prototype,"longNames",void 0),r([o({type:Boolean,json:{read:{source:"minimized"},write:{target:"minimized"}}})],q.prototype,"minimized",void 0),r([o({type:Boolean,json:{read:{source:"pinnedLevels"},write:{target:"pinnedLevels"}}})],q.prototype,"pinnedLevels",void 0),r([o({type:String,json:{read:{source:"site"},write:{target:"site"}}})],q.prototype,"site",void 0),r([o({type:String,json:{read:{source:"facility"},write:{target:"facility"}}})],q.prototype,"facility",void 0),r([o({type:String,json:{read:{source:"level"},write:{target:"level"}}})],q.prototype,"level",void 0),q=lt=r([d("esri.webdoc.widgets.FloorFilter")],q);const hi=q;var pt;const Ze=new ie({slider:"slider",picker:"picker"});let Ae=pt=class extends y{constructor(e){super(e),this.interactionMode=null,this.numStops=null,this.stopInterval=null}clone(){return new pt({interactionMode:this.interactionMode,numStops:this.numStops,stopInterval:this.stopInterval})}};r([o({type:Ze.apiValues,nonNullable:!0,json:{type:Ze.jsonValues,default:null,read:{reader:Ze.read},write:{isRequired:!0,writer:Ze.write}}})],Ae.prototype,"interactionMode",void 0),r([o({type:ge,json:{read:{source:"numberOfStops"},write:{target:"numberOfStops",overridePolicy(){const e=this.stopInterval!=null;return{enabled:!e,isRequired:!e}}}}})],Ae.prototype,"numStops",void 0),r([o({type:Number,json:{write:{overridePolicy(){return{isRequired:this.numStops==null}}}}})],Ae.prototype,"stopInterval",void 0),Ae=pt=r([d("esri.webdoc.widgets.Range")],Ae);const wi=Ae;var ut;let j=ut=class extends y{constructor(e){super(e),this.currentTimeExtent=null,this.fullTimeExtent=null,this.loop=!1,this.numStops=null,this.numThumbs=null,this.stopDelay=null,this.stopInterval=null,this.stops=null}readCurrentTimeExtent(e){if(!e)return;const t=e[0]!=null?new Date(e[0]):null,i=e[1]!=null?new Date(e[1]):null;return new fe({start:t,end:i})}writeCurrentTimeExtent(e,t,i){e&&ot(i,[e.start!=null?e.start.getTime():null,e.end!=null?e.end.getTime():null],t)}readFullTimeExtent(e,t){const i=t.properties;if(!i)return;const s=i.endTime!=null?new Date(i.endTime):null,n=i.startTime!=null?new Date(i.startTime):null;return new fe({start:n,end:s})}writeFullTimeExtent(e,t){if(!e)return;const i=t.properties=t.properties||{},s=e.end,n=e.start;s&&(i.endTime=s!=null?s.getTime():null),n&&(i.startTime=n!=null?n.getTime():null)}readStopInterval(e,t,i){return e?Jt.fromJSON({value:e.interval,unit:e.units},i):null}writeStopInterval(e,t,i,s){if(!e)return;const n=e.toJSON(s);ot("properties.timeStopInterval",{interval:n.value,units:n.unit},t)}readStops(e){return e!=null&&e.length?e.map(t=>new Date(t)):null}writeStops(e,t,i){e!=null&&e.length&&ot(i,e.map(s=>s.getTime()),t)}clone(){return new ut(Z({currentTimeExtent:this.currentTimeExtent,fullTimeExtent:this.fullTimeExtent,loop:this.loop,numStops:this.numStops,numThumbs:this.numThumbs,stopDelay:this.stopDelay,stopInterval:this.stopInterval,stops:this.stops}))}};r([o({type:fe,json:{type:[[ge,Dt]],read:{source:"properties.currentTimeExtent"},write:{target:"properties.currentTimeExtent"}}})],j.prototype,"currentTimeExtent",void 0),r([te("currentTimeExtent")],j.prototype,"readCurrentTimeExtent",null),r([L("currentTimeExtent")],j.prototype,"writeCurrentTimeExtent",null),r([o({type:fe,json:{read:{source:["properties.endTime","properties.startTime"]},write:{target:{"properties.endTime":{type:Number},"properties.startTime":{type:Number}}}}})],j.prototype,"fullTimeExtent",void 0),r([te("fullTimeExtent")],j.prototype,"readFullTimeExtent",null),r([L("fullTimeExtent")],j.prototype,"writeFullTimeExtent",null),r([o({type:Boolean,nonNullable:!0,json:{default:!1,read:{source:"properties.loop"},write:{target:"properties.loop"}}})],j.prototype,"loop",void 0),r([o({type:ge,json:{read:{source:"properties.numberOfStops"},write:{target:"properties.numberOfStops",overridePolicy(){var s;const e=!!this.stopInterval,t=!!((s=this.stops)!=null&&s.length),i=!(e||t);return{enabled:i,isRequired:i}}}}})],j.prototype,"numStops",void 0),r([o({type:[1,2],nonNullable:!0,json:{type:ge,read:{source:"properties.thumbCount"},write:{target:"properties.thumbCount",isRequired:!0}}})],j.prototype,"numThumbs",void 0),r([o({type:Number,nonNullable:!0,json:{read:{source:"properties.thumbMovingRate"},write:{target:"properties.thumbMovingRate",isRequired:!0}}})],j.prototype,"stopDelay",void 0),r([o({type:Jt,json:{read:{source:"properties.timeStopInterval"},write:{target:{"properties.timeStopInterval.interval":{type:Number},"properties.timeStopInterval.units":{type:dr.jsonValues.filter(e=>e!=="esriTimeUnitsUnknown")}},overridePolicy(){var i;const e=this.numStops!=null,t=!!((i=this.stops)!=null&&i.length);return{enabled:!t,isRequired:!(e||t)}}}}})],j.prototype,"stopInterval",void 0),r([te("stopInterval")],j.prototype,"readStopInterval",null),r([L("stopInterval")],j.prototype,"writeStopInterval",null),r([o({type:[Date],json:{type:[ge],read:{source:"properties.stops"},write:{target:"properties.stops",overridePolicy(){return{isRequired:this.numStops==null&&!this.stopInterval}}}}})],j.prototype,"stops",void 0),r([te("stops")],j.prototype,"readStops",null),r([L("stops")],j.prototype,"writeStops",null),j=ut=r([d("esri.webdoc.widgets.TimeSlider")],j);const gi=j;var dt;let _e=dt=class extends y{constructor(e){super(e),this.range=null,this.timeSlider=null,this.floorFilter=null}clone(){return new dt(Z({range:this.range,timeSlider:this.timeSlider,floorFilter:this.floorFilter}))}};r([o({type:wi,json:{write:!0}})],_e.prototype,"range",void 0),r([o({type:gi,json:{write:!0}})],_e.prototype,"timeSlider",void 0),r([o({type:hi,json:{write:!0}})],_e.prototype,"floorFilter",void 0),_e=dt=r([d("esri.webdoc.Widgets")],_e);const vi=_e,fi={width:600,height:400},Ke=1.5;function bi(e,t){t=t||fi;let{width:i,height:s}=t;const n=i/s;return n<Ke?s=i/Ke:n>Ke&&(i=s*Ke),i>e.width&&(s*=e.width/i,i=e.width),s>e.height&&(i*=e.height/s,s=e.height),{width:Math.round(i),height:Math.round(s)}}function Si(e,t){var i;return t.resourceInfo?Ht(t,t.resourceInfo,{origin:e.origin}):(i=t.portalItem)!=null&&i.id?Ii(e,t,t.portalItem):Promise.resolve()}function Ht(e,t,i){const s={context:{...i,layerContainerType:"operational-layers"}};return e.portalItem&&(s.context.portal=e.portalItem.portal||cr.getDefault()),N(()=>import("./layersCreator-cHKAEJTP.js"),__vite__mapDeps([22,1,2,23,24,25])).then(({populateOperationalLayers:n})=>{const a=[],l=t.operationalLayers;l!=null&&l.length&&a.push(n(e.layers,l,s));const p={...s,context:{...s.context,layerContainerType:"tables"},defaultLayerType:"ArcGISFeatureLayer"},u=t.tables;return u!=null&&u.length&&a.push(n(e.tables,u,p)),Promise.allSettled(a).then(()=>{})})}async function Ii(e,t,i){var l;if(await i.load().catch(p=>{throw new re(`${e.name}:load-portal-item`,"Failed to load portal item",{error:p})}),i.type!==e.itemType)throw new re(`${e.name}:invalid-portal-item`,`Invalid portal item type '${i.type}', expected '${e.itemType}'`,{type:i.type});const s=await i.fetchData();t.resourceInfo=s;const n=xr(i,e.origin);await Ti(e,t,s,n),t.resourceReferences={portalItem:i,paths:n.readResourcePaths};const a=await Ni(t.initialViewProperties,i,Ve.getLogger(t));if(a){const p=((l=t.initialViewProperties)==null?void 0:l.clone())??e.createInitialViewProperties();p.viewpoint=a,t.initialViewProperties=p}}function Ti(e,t,i,s){const n=ji(e,i);return t.read(n,s),Ht(t,n,s)}function ji(e,t){const i=e.parseVersion(t.version||"",e.name);return e.currentVersion.validate(i),t.version=`${i.major}.${i.minor}`,t}async function Ni(e,t,i){var a;if((a=e==null?void 0:e.viewpoint)==null?void 0:a.targetGeometry)return null;const n=await Ei(e,t,i);return n?new be({targetGeometry:n}):null}async function Ei(e,t,i){const s=e==null?void 0:e.spatialReference,n=t==null?void 0:t.extent;if(!s||!n)return null;if(s.isWGS84)return n.clone();if(s.isWebMercator)return yr(n);const{getGeometryServiceURL:a}=await N(()=>import("./geometryServiceUtils-8kX1-1eq.js"),__vite__mapDeps([26,1,2,11]));try{const l=await a(t),p=new Or({geometries:[n],outSpatialReference:s});return(await Cr(l,p))[0]}catch(l){i.error("Error projecting item's extent:",l)}return null}function Ct(e){return{enabled:!!(e!=null&&e.length)}}var ct;let ke=ct=class extends y{constructor(e){super(e),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new ct({exactMatch:this.exactMatch,type:this.type,name:this.name})}};r([o({type:Boolean,json:{write:!0}})],ke.prototype,"exactMatch",void 0),r([o({type:String,json:{write:!0}})],ke.prototype,"name",void 0),r([W(Mt)],ke.prototype,"type",void 0),ke=ct=r([d("esri.webdoc.applicationProperties.SearchLayerField")],ke);const $i=ke;var yt;let Re=yt=class extends y{constructor(e){super(e),this.field=null,this.id=null,this.subLayer=null}clone(){return new yt(Z({field:this.field,id:this.id,subLayer:this.subLayer}))}};r([o({type:$i,json:{write:{isRequired:!0}}})],Re.prototype,"field",void 0),r([o({type:String,json:{write:{isRequired:!0}}})],Re.prototype,"id",void 0),r([o({type:ge,json:{write:!0}})],Re.prototype,"subLayer",void 0),Re=yt=r([d("esri.webdoc.applicationProperties.SearchLayer")],Re);const Ai=Re;var mt;let xe=mt=class extends y{constructor(e){super(e),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new mt({exactMatch:this.exactMatch,type:this.type,name:this.name})}};r([o({type:Boolean,json:{write:!0}})],xe.prototype,"exactMatch",void 0),r([o({type:String,json:{write:!0}})],xe.prototype,"name",void 0),r([W(Mt)],xe.prototype,"type",void 0),xe=mt=r([d("esri.webdoc.applicationProperties.SearchTableField")],xe);const _i=xe;var ht;let Pe=ht=class extends y{constructor(e){super(e),this.field=null,this.id=null}clone(){return new ht(Z({field:this.field,id:this.id}))}};r([o({type:_i,json:{write:{isRequired:!0}}})],Pe.prototype,"field",void 0),r([o({type:String,json:{write:{isRequired:!0}}})],Pe.prototype,"id",void 0),Pe=ht=r([d("esri.webdoc.applicationProperties.SearchTable")],Pe);const ki=Pe;var wt;const Wt=tt.ofType(Ai),Zt=tt.ofType(ki);let z=wt=class extends y{constructor(e){super(e),this.addressSearchEnabled=!0,this.enabled=!0,this.hintText=null,this.layers=new Wt,this.tables=new Zt}readAddressSearchEnabled(e){return!e}writeAddressSearchEnabled(e,t,i){t[i]=!e}clone(){return new wt(Z({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers,tables:this.tables}))}};r([o({type:Boolean,nonNullable:!0,json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder",isRequired:!0},origins:{"web-scene":{read:!1,write:!1}}}})],z.prototype,"addressSearchEnabled",void 0),r([te("addressSearchEnabled")],z.prototype,"readAddressSearchEnabled",null),r([L("addressSearchEnabled")],z.prototype,"writeAddressSearchEnabled",null),r([o({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-map":{write:{isRequired:!0}},"web-scene":{default:!0,write:!0}}}})],z.prototype,"enabled",void 0),r([o({type:String,json:{write:!0}})],z.prototype,"hintText",void 0),r([o({type:Wt,json:{write:{overridePolicy:Ct},origins:{"web-scene":{write:{isRequired:!0}}}}})],z.prototype,"layers",void 0),r([o({type:Zt,json:{read:!0,write:{overridePolicy:Ct}}})],z.prototype,"tables",void 0),z=wt=r([d("esri.webdoc.applicationProperties.Search")],z);const Ri=z;var gt;let Xe=gt=class extends y{constructor(e){super(e),this.search=null}clone(){return new gt(Z({search:this.search}))}};r([o({type:Ri,json:{write:!0}})],Xe.prototype,"search",void 0),Xe=gt=r([d("esri.webdoc.applicationProperties.Viewing")],Xe);const xi=Xe;var vt;let Oe=vt=class extends y{constructor(e){super(e),this.editing=null,this.offline=null,this.viewing=null}clone(){return new vt(Z({editing:this.editing,offline:this.offline,viewing:this.viewing}))}};r([o({json:{write:!0}})],Oe.prototype,"editing",void 0),r([o({json:{write:!0}})],Oe.prototype,"offline",void 0),r([o({type:xi,json:{write:!0}})],Oe.prototype,"viewing",void 0),Oe=vt=r([d("esri.webmap.ApplicationProperties")],Oe);const Oi=Oe;function Ci(e){return!!e&&/^https:\/\/.*/i.test(e)}function Vi(e){return!!e&&/data:([-\w]+\/[-+\w.]+)?(;?\w+=[-\w]+)*(;base64)?,.*/gu.test(e)}var ft;let ee=ft=class extends y{constructor(){super(...arguments),this.url=""}destroy(){this.url=""}get isSecureUrl(){return Ci(this.url)}get isDataURI(){return Vi(this.url)}clone(){return new ft({url:this.url})}};r([o({type:String,json:{write:{isRequired:!0}}})],ee.prototype,"url",void 0),r([o()],ee.prototype,"isSecureUrl",null),r([o()],ee.prototype,"isDataURI",null),ee=ft=r([d("esri.webdoc.support.SlideThumbnail")],ee);const Ui={type:fe,json:{read:{source:"timeExtent",reader:e=>e?Array.isArray(e)?fe.fromArray(e):fe.fromJSON(e):null},write:{writer:(e,t,i,s)=>{e&&(e.isEmpty?s!=null&&s.messages&&s.messages.push(new re("invalid-timeExtent","TimeExtent cannot be empty")):t[i]=e.toArray())},target:{timeExtent:{type:[[ge,Dt]]}}}}};var bt;let H=bt=class extends mr(y){constructor(e){super(e),this.name=null,this.thumbnail=new ee,this.timeExtent=null}castThumbnail(e){return typeof e=="string"?new ee({url:e}):hr(ee,e)}set viewpoint(e){const{targetGeometry:t,scale:i}=e;t!=null&&t.type==="point"&&i==null&&Ve.getLogger(this).warn("Bookmark.viewpoint should include 'scale' when its targetGeometry is a point.",e),this._set("viewpoint",e)}readViewpoint(e,t){const{extent:i,viewpoint:s}=t;return be.fromJSON(s||{targetGeometry:i})}writeViewpoint(e,t,i,s){if(!e)return;const{targetGeometry:n}=e;if(n==null||n.type==="extent")n!=null&&(t.extent=n.toJSON()),t[i]=e.toJSON();else{const a="Bookmark.viewpoint cannot be written to JSON when the viewpoint's targetGeometry is not an extent.";s!=null&&s.messages?s.messages.push(new re("property:unsupported",a)):Ve.getLogger(this).error(a)}}clone(){return new bt(Z({name:this.name,thumbnail:this.thumbnail,timeExtent:this.timeExtent,viewpoint:this.viewpoint}))}};r([o({type:String,nonNullable:!0,json:{write:{isRequired:!0}}})],H.prototype,"name",void 0),r([o({type:ee,json:{write:{overridePolicy:e=>({enabled:!(!e||!e.url)})}}})],H.prototype,"thumbnail",void 0),r([wr("thumbnail")],H.prototype,"castThumbnail",null),r([o(Ui)],H.prototype,"timeExtent",void 0),r([o({type:be,nonNullable:!0,json:{write:!0}})],H.prototype,"viewpoint",null),r([te("viewpoint",["extent","viewpoint"])],H.prototype,"readViewpoint",null),r([L("viewpoint")],H.prototype,"writeViewpoint",null),H=bt=r([d("esri.webmap.Bookmark")],H);const Li=H;let ce=class extends oe(Gt){constructor(e){super(e),this.background=null,this.rangeInfo=null,this.spatialReference=null,this.timeZone=gr,this.viewpoint=null}};r([o({type:Tt})],ce.prototype,"background",void 0),r([o({type:Nt})],ce.prototype,"rangeInfo",void 0),r([o({type:De})],ce.prototype,"spatialReference",void 0),r([o({nonNullable:!0})],ce.prototype,"timeZone",void 0),r([o({type:be})],ce.prototype,"viewpoint",void 0),ce=r([d("esri.webmap.InitialViewProperties")],ce);const et=ce;class Ce extends vr{constructor(t,i){super(t,i,"webmap")}}const Ge=new Ce(2,31),Fi="Web Map",Pi="webmap",St="web-map",Kt=tt.ofType(Li),Gi=tt.ofType(Bt),Di=new Map([["image/jpeg","jpeg"],["image/jpg","jpg"],["image/png","png"],["image/gif","gif"]]),Ji="ArcGIS Pro",Mi=kr.JSAPI,st={currentVersion:Ge,createInitialViewProperties:()=>new et,parseVersion:Ce.parse,itemType:Fi,name:Pi,origin:St};let m=class extends Lt(It.LoadableMixin(fr(Rr))){constructor(e){super(e),this._isAuthoringAppSetByUser=!1,this._isAuthoringAppVersionSetByUser=!1,this._thumbnailFilename=null,this._updateFromPromise=null,this.resourceReferences={portalItem:null,paths:[]},this.applicationProperties=null,this.bookmarks=new Kt,this.floorInfo=null,this.geotriggersInfo=null,this.initialViewProperties=new et,this.ipsInfo=null,this.portalItem=null,this.presentation=null,this.sourceVersion=null,this.widgets=null,this.utilityNetworks=null,this._debouncedSaveOperations=br(async(t,i,s)=>{const{save:n,saveAs:a}=await N(()=>import("./webdocSaveUtils-UTgJEMNG.js"),__vite__mapDeps([27,1,2,28,29,10,11,8,5,6,30,31,32]));switch(t){case Me.SAVE:return n(st,this,i);case Me.SAVE_AS:return a(st,this,s,i)}}),this.authoringApp=this.authoringAppVersion=null,this._isAuthoringAppSetByUser=this._isAuthoringAppVersionSetByUser=!1}destroy(){if(this.portalItem=Sr(this.portalItem),this.utilityNetworks){const e=this.utilityNetworks.removeAll();for(const t of e)t.destroy();this.utilityNetworks.destroy()}}initialize(){if(this.when().catch(e=>{Ve.getLogger(this).error("#load()","Failed to load web map",e)}),this.resourceInfo){let e;try{e=this._validateJSON(this.resourceInfo)}catch(t){return void this.addResolvingPromise(Promise.reject(t))}this.read(e)}}set authoringApp(e){this._isAuthoringAppSetByUser=!0,this._set("authoringApp",e)}writeAuthoringApp(e,t){e&&this._isAuthoringAppSetByUser?t.authoringApp=e:t.authoringApp=Mi}set authoringAppVersion(e){this._isAuthoringAppVersionSetByUser=!0,this._set("authoringAppVersion",e)}writeAuthoringAppVersion(e,t){e&&this._isAuthoringAppVersionSetByUser?t.authoringAppVersion=e:t.authoringAppVersion=Ir}readInitialViewProperties(e,t){var n;const i=new et;t.background&&(i.background=Tt.fromJSON(t.background));const s=(n=t.initialState)==null?void 0:n.viewpoint;return s&&(s.rotation&&Ce.parse(t.version||"","webmap").lessThan(2,20)&&t.authoringApp===Ji&&(s.rotation*=-1),i.viewpoint=be.fromJSON(s)),t.mapRangeInfo&&(i.rangeInfo=Nt.fromJSON(t.mapRangeInfo)),t.spatialReference&&(i.spatialReference=De.fromJSON(t.spatialReference)),t.timeZone&&(i.timeZone=t.timeZone),i}writeInitialViewProperties(e,t,i,s){var n;e&&((n=e.background)!=null&&n.color&&(t.background=e.background.write({},s)),e.viewpoint&&(t.initialState={viewpoint:e.viewpoint.write({},s)}),e.rangeInfo&&(t.mapRangeInfo=e.rangeInfo.toJSON(s)),e.spatialReference&&(t.spatialReference=e.spatialReference.write({},s)),t.timeZone=e.timeZone)}writeLayers(e,t,i,s){t[i]=this._writeLayers(e,s,"operational-layers")}readSourceVersion(e,t){const[i,s]=t.version.split(".");return new Ce(parseInt(i,10),parseInt(s,10))}writeSourceVersion(e,t,i){t[i]=`${Ge.major}.${Ge.minor}`}writeTables(e,t,i,s){const n=this._writeLayers(e,s,"tables");n.length&&(t[i]=n)}get thumbnailUrl(){var e;return((e=this.portalItem)==null?void 0:e.thumbnailUrl)||null}set thumbnailUrl(e){e?(this._override("thumbnailUrl",e),this._thumbnailFilename=this._generateCustomThumbnailFilename(e)):this._clearThumbnailOverride()}get updatingFromView(){return!!this._updateFromPromise}load(e){return this.addResolvingPromise(Si(st,this)),Promise.resolve(this)}loadAll(){return Tr(this,e=>{e(this.ground,this.basemap,this.layers,this.tables)})}read(e,t){t={...t,origin:St};const i=this._getAuthoringPropsState();jr(this,e,s=>super.read(e,s),t),this._restoreAuthoringPropsFromState(i)}write(e,t){if(this.loadStatus!=="loaded"){const i=new re("webmap:not-loaded","Web map must be loaded before it can be serialized");throw Ve.getLogger(this).error("#toJSON()","Web map must be loaded before it can be serialized",this.loadError||this.loadStatus),i}return this._removeDanglingLayerRefs(),t={...t,origin:St,restrictedWebMapWriting:!0,webmap:this},super.write(e,t)}async save(e){return this._debouncedSaveOperations(Me.SAVE,e)}async saveAs(e,t){return this._debouncedSaveOperations(Me.SAVE_AS,t,e)}async updateFrom(e,t){const i=this._updateFromInternal(e,t);this._updateFromPromise=i,await i,i===this._updateFromPromise&&(this._updateFromPromise=null)}getLayerJSONFromResourceInfo(e){var i,s,n,a;const t=this.resourceInfo;return this._collectAllLayersJSON([...((i=t==null?void 0:t.baseMap)==null?void 0:i.baseMapLayers)||[],...(t==null?void 0:t.operationalLayers)||[],...((a=(n=(s=this.basemap)==null?void 0:s.resourceInfo)==null?void 0:n.data)==null?void 0:a.baseMapLayers)||[]]).find(l=>l.id===e.id)}async updateItemThumbnail(){var e;this.thumbnailUrl&&this._isOverridden("thumbnailUrl")&&(await((e=this.portalItem)==null?void 0:e.updateThumbnail({thumbnail:this.thumbnailUrl,filename:this._thumbnailFilename})),this._clearThumbnailOverride())}getThumbnailState(){let e=this.thumbnailUrl;return e&&(e=this._isOverridden("thumbnailUrl")?e:Nr(e,"w","8192")),{thumbnailUrl:e,filename:this._thumbnailFilename}}restoreThumbnailFromState(e){this.thumbnailUrl=e.thumbnailUrl,this._thumbnailFilename=e.filename}_collectAllLayersJSON(e){return e.reduce((t,i)=>(t.push(i),i.layerType==="GroupLayer"&&(t=t.concat(this._collectAllLayersJSON(i.layers||[]))),t),[])}_writeLayers(e,t,i){return t={...t,layerContainerType:i},e.map(s=>Vr(s,i==="tables"?null:this.getLayerJSONFromResourceInfo(s),t)).filter(Er).toArray()}_validateJSON(e){const t=Ce.parse(e.version||"","webmap");return Ge.validate(t),e.version=`${t.major}.${t.minor}`,e}_removeDanglingLayerRefs(){var n,a,l;const e=this.applicationProperties,t=(n=e==null?void 0:e.viewing)==null?void 0:n.search,i=p=>this.allLayers.some(u=>u.id===p);if(t!=null&&t.layers&&(t.layers=t.layers.filter(p=>i(p.id))),t!=null&&t.tables&&(t.tables=t.tables.filter(p=>this.tables.some(u=>u.id===p.id))),e){const p=(a=e.editing)==null?void 0:a.locationTracking;p!=null&&p.info&&!i(p.info.layerId)&&(e.editing=null)}const s=(l=this.presentation)==null?void 0:l.slides;s&&s.forEach(p=>{p.visibleLayers&&(p.visibleLayers=p.visibleLayers.filter(u=>i(u.id)))})}async _updateFromInternal(e,t){if(t??(t={}),await $r(()=>e.ready),this._updateInitialViewProperties(e,t),e.map===this)for(const i of e.allLayerViews)"visible"in i&&"visible"in i.layer&&i._isOverridden("visible")&&(i.layer.visible=i.visible),"featureEffect"in i&&"featureEffect"in i.layer&&i._isOverridden("featureEffect")&&(i.layer.featureEffect=i.featureEffect);await this._updateThumbnailUrl(e,t)}_updateInitialViewProperties(e,t){var i,s;if(t.backgroundExcluded||(this.initialViewProperties.background=(i=e.background)==null?void 0:i.clone()),this.initialViewProperties.spatialReference=(s=e.spatialReference)==null?void 0:s.clone(),this.initialViewProperties.timeZone=e.timeZone,t.viewpointExcluded||(this.initialViewProperties.viewpoint=new be({rotation:e.rotation,scale:t.scalePreserved?e.scale:null,targetGeometry:this._getViewExtent(e)})),!t.widgetsExcluded)for(const n of e.persistableViewModels)n.updateWebDocument(this)}_getViewExtent(e){const t=e.center.clone().normalize(),i=e.extent.clone(),s=i.width/2;return i.xmin=t.x-s,i.xmax=t.x+s,i}async _updateThumbnailUrl(e,t){if(t.thumbnailExcluded)return;const i=bi(e,t.thumbnailSize),s=await e.takeScreenshot({format:"png",width:i.width,height:i.height});this._setAutoGeneratedThumbnail(s.dataUrl)}_setAutoGeneratedThumbnail(e){this.thumbnailUrl=e,this._thumbnailFilename=null}_clearThumbnailOverride(){this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"),this._thumbnailFilename=null}_generateCustomThumbnailFilename(e){if(Ar(e)){const t=_r(e),i=t==null?void 0:t.mediaType,s=i&&Di.get(i.toLowerCase())||null,n=`thumbnail${Date.now()}`;return s?`${n}.${s}`:n}return null}_getAuthoringPropsState(){return{authoringApp:this.authoringApp,authoringAppVersion:this.authoringAppVersion,isAuthoringAppSetByUser:this._isAuthoringAppSetByUser,isAuthoringAppVersionSetByUser:this._isAuthoringAppVersionSetByUser}}_restoreAuthoringPropsFromState(e){e.isAuthoringAppSetByUser?this.authoringApp=e.authoringApp:this._isAuthoringAppSetByUser=!1,e.isAuthoringAppVersionSetByUser?this.authoringAppVersion=e.authoringAppVersion:this._isAuthoringAppVersionSetByUser=!1}static fromJSON(e){const t=e;if(!t)throw new re("webmap:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:t})}};m.VERSION=Ge,r([o()],m.prototype,"_updateFromPromise",void 0),r([o({type:Oi,json:{write:!0}})],m.prototype,"applicationProperties",void 0),r([o({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],m.prototype,"authoringApp",null),r([L("authoringApp")],m.prototype,"writeAuthoringApp",null),r([o({type:String,json:{write:{allowNull:!0,ignoreOrigin:!0}}})],m.prototype,"authoringAppVersion",null),r([L("authoringAppVersion")],m.prototype,"writeAuthoringAppVersion",null),r([o({type:Kt,json:{write:{overridePolicy:e=>({enabled:!!(e&&e.length>0),ignoreOrigin:!0})}}})],m.prototype,"bookmarks",void 0),r([o({type:oi,json:{name:"mapFloorInfo",write:!0}})],m.prototype,"floorInfo",void 0),r([o({type:mi,json:{write:!0}})],m.prototype,"geotriggersInfo",void 0),r([o({type:et,nonNullable:!0,json:{read:{source:["background","initialState.viewpoint","mapRangeInfo","spatialReference","timeZone"]},write:{ignoreOrigin:!0,target:{background:{type:Tt},"initialState.viewpoint":{type:be},mapRangeInfo:{type:Nt},spatialReference:{type:De},"timeZone:":{type:String}}}}})],m.prototype,"initialViewProperties",void 0),r([te("initialViewProperties")],m.prototype,"readInitialViewProperties",null),r([L("initialViewProperties")],m.prototype,"writeInitialViewProperties",null),r([o({json:{write:!0,name:"mapIPSInfo"}})],m.prototype,"ipsInfo",void 0),r([o({json:{read:!1,write:{target:"operationalLayers",ignoreOrigin:!0}}})],m.prototype,"layers",void 0),r([L("layers")],m.prototype,"writeLayers",null),r([o({type:nt})],m.prototype,"portalItem",void 0),r([o({json:{write:!0}})],m.prototype,"presentation",void 0),r([o()],m.prototype,"resourceInfo",void 0),r([o({readOnly:!0,type:Ce,json:{read:{source:"version"},write:{allowNull:!0,ignoreOrigin:!0,target:"version",isRequired:!0}}})],m.prototype,"sourceVersion",void 0),r([te("sourceVersion")],m.prototype,"readSourceVersion",null),r([L("sourceVersion")],m.prototype,"writeSourceVersion",null),r([o({json:{read:!1,write:{ignoreOrigin:!0}}})],m.prototype,"tables",void 0),r([L("tables")],m.prototype,"writeTables",null),r([o()],m.prototype,"thumbnailUrl",null),r([o()],m.prototype,"updatingFromView",null),r([o({type:vi,json:{write:!0}})],m.prototype,"widgets",void 0),r([o({type:Gi,json:{read:!0,write:!0}})],m.prototype,"utilityNetworks",void 0),m=r([d("esri.WebMap")],m);const Bi=m,$o=Object.freeze(Object.defineProperty({__proto__:null,default:Bi},Symbol.toStringTag,{value:"Module"}));export{$o as W,Kr as a,Ur as b,Xi as c,Br as d,Qi as i,qe as o,Zr as p,Mr as s};
