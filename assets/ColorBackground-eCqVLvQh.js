const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ElevationQuery-BXghklvc.js","assets/index-Bk13oInq.js","assets/index-CXj0dB5Q.css","assets/TileKey-DZd6gJy7.js","assets/layersCreator-Bv_r8Fsa.js","assets/portalLayers-TGpMnxDn.js","assets/associatedFeatureServiceUtils-BNrydjXV.js","assets/lazyLayerLoader-Bdu_Y0I1.js"])))=>i.map(i=>d[i]);
import{e as o,y as a,a as h,jc as D,dv as V,bg as f,R as j,jb as d,k as F,h as J,d as m,ab as M,jH as H,fB as G,o as W,eH as Q,f$ as U,V as Z,bd as K,n as I,u as N,dn as X,kj as Y,A as ee,ft as te,C as L,cS as _,ag as E,fK as R,ki as re,kk as oe,cw as O,aJ as se,aI as ae,b as ie,c2 as ne,W as le,hd as z}from"./index-Bk13oInq.js";import{a as pe}from"./Cyclical-DJv7mGBZ.js";import{F as ye}from"./Basemap-DRYqJJ3x.js";import{a as ue}from"./catalogUtils-8MGqu6UW.js";import{y as de,m as ce,b as he}from"./basemapUtils-CYwIlTGS.js";import{n as me,l as ve,t as we}from"./TablesMixin-C8r3nFk7.js";let c=class extends D{constructor(t){super(t),this.row=0,this.column=0,this.rows=1,this.columns=1}equals(t){return t!=null&&this.row===t.row&&this.rows===t.rows&&this.column===t.column&&this.columns===t.columns}};o([a({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],c.prototype,"row",void 0),o([a({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],c.prototype,"column",void 0),o([a({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],c.prototype,"rows",void 0),o([a({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],c.prototype,"columns",void 0),c=o([h("esri.CameraLayout")],c);const k=c;let l=class extends V(f){constructor(...e){super(...e),this.position=new j([0,0,0]),this.heading=0,this.tilt=0,this.fov=55,this.layout=new k}normalizeCtorArgs(e,t,s,r){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const i={position:e};return t!=null&&(i.heading=t),s!=null&&(i.tilt=s),r!=null&&(i.fov=r),i}return e}writePosition(e,t,s,r){const i=e.clone();i.x=d(e.x||0),i.y=d(e.y||0),i.z=e.hasZ?d(e.z||0):e.z,t[s]=i.write({},r)}readPosition(e,t){const s=new j;return s.read(e,t),s.x=d(s.x||0),s.y=d(s.y||0),s.z=s.hasZ?d(s.z||0):s.z,s}equals(e){return e!=null&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)&&this.layout.equals(e.layout)}};o([a({type:j,json:{write:{isRequired:!0}}})],l.prototype,"position",void 0),o([F("position")],l.prototype,"writePosition",null),o([J("position")],l.prototype,"readPosition",null),o([a({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),m(e=>pe.normalize(d(e)))],l.prototype,"heading",void 0),o([a({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),m(e=>M(d(e),-180,180))],l.prototype,"tilt",void 0),o([a({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],l.prototype,"fov",void 0),o([a({type:k,nonNullable:!0,json:{read:!1,write:!1}})],l.prototype,"layout",void 0),l=o([h("esri.Camera")],l);const ge=l;var S;let u=S=class extends f{constructor(e){super(e),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(e){return(e%=360)<0&&(e+=360),e}clone(){return new S({rotation:this.rotation,scale:this.scale,targetGeometry:this.targetGeometry!=null?this.targetGeometry.clone():null,camera:this.camera!=null?this.camera.clone():null})}};o([a({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:C}}}}})],u.prototype,"rotation",void 0),o([m("rotation")],u.prototype,"castRotation",null),o([a({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:C}}}}})],u.prototype,"scale",void 0),o([a({types:H,json:{read:G,write:!0,origins:{"web-scene":{read:G,write:{overridePolicy:C}}}}})],u.prototype,"targetGeometry",void 0),o([a({type:ge,json:{write:!0}})],u.prototype,"camera",void 0),u=S=o([h("esri.Viewpoint")],u);const Ae=u;function C(){return{enabled:!this.camera}}var A;let w=A=class extends f{constructor(e){super(e),this.type="none"}clone(){return new A({type:this.type})}};o([W({none:"none",stayAbove:"stay-above"})],w.prototype,"type",void 0),w=A=o([h("esri.ground.NavigationConstraint")],w);var T;let p=T=class extends Q(U){constructor(e){super(e),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new Z;const t=r=>{r.parent&&r.parent!==this&&"remove"in r.parent&&r.parent.remove(r),r.parent=this,r.type!=="elevation"&&r.type!=="base-elevation"&&I.getLogger(this).error(`Layer '${r.title}, id:${r.id}' of type '${r.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},s=r=>{r.parent=null};this.addHandles([this.layers.on("after-add",r=>t(r.item)),this.layers.on("after-remove",r=>s(r.item))])}initialize(){this.when().catch(e=>{K(e)||I.getLogger(this).error("#load()","Failed to load ground",e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.layers.removeAll();for(const t of e)N(t);this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}set layers(e){this._set("layers",X(e,this._get("layers")))}writeLayers(e,t,s,r){const i=[];e&&(r={...r,layerContainerType:"ground"},e.forEach(y=>{if("write"in y){const v={};Y(y)().write(v,r)&&i.push(v)}else r!=null&&r.messages&&r.messages.push(new ee("layer:unsupported",`Layers (${y.title}, ${y.id}) of type '${y.declaredClass}' cannot be persisted in the ground`,{layer:y}))})),t.layers=i}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return te(this,e=>{e(this.layers)})}async queryElevation(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:s}=await L(()=>import("./ElevationQuery-BXghklvc.js"),__vite__mapDeps([0,1,2,3]));_(t);const r=new s,i=this.layers.filter(q).toArray();return r.queryAll(i,e,t)}async createElevationSampler(e,t){await this.load({signal:t==null?void 0:t.signal});const{ElevationQuery:s}=await L(()=>import("./ElevationQuery-BXghklvc.js"),__vite__mapDeps([0,1,2,3]));_(t);const r=new s,i=this.layers.filter(q).toArray();return r.createSamplerAll(i,e,t)}clone(){const e={opacity:this.opacity,surfaceColor:E(this.surfaceColor),navigationConstraint:E(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new T({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}_loadFromSource(e){const t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Promise.resolve()}async _loadLayersFromJSON(e,t,s){const r=(t==null?void 0:t.origin)||"web-scene",i=(t==null?void 0:t.portal)||null,y=(t==null?void 0:t.url)||null,{populateOperationalLayers:v}=await L(async()=>{const{populateOperationalLayers:$}=await import("./layersCreator-Bv_r8Fsa.js");return{populateOperationalLayers:$}},__vite__mapDeps([4,1,2,5,6,7]));_(s);const P=[];if(e.layers&&Array.isArray(e.layers)){const $={context:{origin:r,url:y,portal:i,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};P.push(v(this.layers,e.layers,$))}await Promise.allSettled(P)}};function be(e){return e&&"createElevationSampler"in e}function q(e){return e.type==="elevation"||be(e)}o([a({json:{read:!1}})],p.prototype,"layers",null),o([F("layers")],p.prototype,"writeLayers",null),o([a({readOnly:!0})],p.prototype,"resourceInfo",void 0),o([a({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:R,read:{reader:re,source:"transparency"},write:{writer:(e,t)=>{t.transparency=oe(e)},target:"transparency"}}})],p.prototype,"opacity",void 0),o([a({type:O,json:{type:[R],write:(e,t)=>{t.surfaceColor=e.toJSON().slice(0,3)}}})],p.prototype,"surfaceColor",void 0),o([a({type:w,json:{write:!0}})],p.prototype,"navigationConstraint",void 0),p=T=o([h("esri.Ground")],p);const b=p;function fe(e){return typeof e=="object"&&e!=null&&"loaded"in e&&e.loaded===!0&&"type"in e}function $e(e){var t,s;return!(!fe(e)||!((s=(t=se(e))==null?void 0:t.operations)!=null&&s.supportsEditing)||"editingEnabled"in e&&!ae(e)||ue(e))}const B={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function Le(e){let t=null;if(typeof e=="string")if(e in B){const s=B[e];t=new b({resourceInfo:{data:{layers:[s]}}})}else I.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${e}. Try "world-elevation"`);else t=ie(b,e);return t}let n=class extends me(ve(ne.EventedMixin(le))){constructor(e){super(e),this.allLayers=new z({getCollections:()=>{var t,s,r;return[(t=this.basemap)==null?void 0:t.baseLayers,(s=this.ground)==null?void 0:s.layers,this.layers,(r=this.basemap)==null?void 0:r.referenceLayers]},getChildrenFunction:t=>"layers"in t?t.layers:null}),this.allTables=we(this),this.basemap=null,this.editableLayers=new z({getCollections:()=>[this.allLayers],itemFilterFunction:$e}),this.ground=new b,this._basemapCache=de()}destroy(){ce(this._basemapCache),this._basemapCache=null,this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.basemap=N(this.basemap),N(this.ground),this._set("ground",null)}castBasemap(e){return he(e,this._basemapCache)}castGround(e){return Le(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(t=>t.id===e)}findTableById(e){return this.allTables.find(t=>t.id===e)}};o([a({readOnly:!0,dependsOn:[]})],n.prototype,"allLayers",void 0),o([a({readOnly:!0})],n.prototype,"allTables",void 0),o([a({type:ye,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],n.prototype,"basemap",void 0),o([m("basemap")],n.prototype,"castBasemap",null),o([a({readOnly:!0})],n.prototype,"editableLayers",void 0),o([a({type:b,nonNullable:!0})],n.prototype,"ground",void 0),o([m("ground")],n.prototype,"castGround",null),o([a()],n.prototype,"undoRedo",void 0),n=o([h("esri.Map")],n);const Te=n;var x;let g=x=class extends f{constructor(e){super(e),this.color=new O([0,0,0,1])}clone(){return new x(E({color:this.color}))}};o([a({type:O,json:{write:!0}})],g.prototype,"color",void 0),g=x=o([h("esri.webmap.background.ColorBackground")],g);const xe=g;export{Te as L,xe as a,Ae as m};
