const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/calcite-scrim-BVz2eq8G.js","assets/index-DeC8R2EY.js","assets/index-CXj0dB5Q.css","assets/calcite-chip-4IvQqaFU.js"])))=>i.map(i=>d[i]);
import{ll as L,F as P,B as ie,cb as j,bD as _e,lm as se,bd as ae,g9 as W,E as Se,ln as V,lo as $e,l as u,cK as xe,cz as Te,lp as Re,bf as Me,bg as Be,bE as Ee,be as Ie,lq as Ce,lr as ke,gH as Le,b5 as N,cS as Oe,cT as Q,b1 as ne,cW as Ae,cV as Ge,ls as ze,V as k,T as H,lt as We,bN as Fe,lu as Pe,lv as He,eM as qe,a6 as he,a7 as E,dB as Ue,aN as ue,e as l,y as h,a as z,gf as J,iC as De,C as me,dg as je,n as Ne,d as Ve,a9 as Qe,a8 as de,Y as re,bj as Ke,cH as Je,cI as Ye,m as le,gq as Xe}from"./index-DeC8R2EY.js";import{U as Ze,R as et,O as tt,d as it,L as st}from"./basemapUtils-HzHsFYAS.js";import{e as at,B as nt,m as rt,r as lt,n as f}from"./jsxFactory-DiRSUczt.js";import{F as X}from"./Basemap-CLA9H8hr.js";import{l as D,a as oe}from"./ViewingMode-dBUh39ak.js";import{z as q,p as U}from"./TileInfo-Cr8gfvFO.js";import{e as O}from"./globalCss-CZa70j6i.js";import{e as ot}from"./Heading-EvgmN1VA.js";import{t as ct}from"./accessibleHandler-CyRbo2BQ.js";import"./uuid-fwrPAdZb.js";import"./writeUtils-CAU0mSSk.js";import"./TileKey-DZd6gJy7.js";function pt(e,t){return e!=null&&(t==null||(t===D.Local?!e.isGeographic||e.isWGS84||e.wkid===L.CGCS2000:e.isWebMercator||e.isWGS84||e.wkid===L.CGCS2000||e.wkid===L.GCSMARS2000||e.wkid===L.GCSMARS2000_SPHERE||e.wkid===L.GCSMOON2000))}const ht=12;let M=class g{constructor(t){const i=g.checkUnsupported(t);if(i!=null)throw i;const s=t;this.spatialReference=s.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=_e(this.spatialReference),this.origin=[s.origin.x,s.origin.y],this.pixelSize=s.size[0],this.dpi=s.dpi;const a=s.lods.reduce((c,m)=>(m.level<c.minLod.level&&(c.minLod=m),c.max=Math.max(c.max,m.level),c),{minLod:s.lods[0],max:-1/0}),n=a.minLod,r=2**n.level;let o=n.resolution*r,p=n.scale*r;this.levels=new Array(a.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:o,scale:p,tileSize:[o*s.size[0],o*s.size[1]]},o/=2,p/=2}clone(){return new g(this.toTileInfo())}toTileInfo(){return new q({dpi:this.dpi,origin:new P({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((t,i)=>new U({level:i,scale:t.scale,resolution:t.resolution}))})}getExtent(t,i,s,a){const n=this.levels[t],r=n.tileSize[0],o=n.tileSize[1];a[0]=this.origin[0]+s*r,a[2]=this.origin[0]+(s+1)*r,a[3]=this.origin[1]-i*o,a[1]=this.origin[1]-(i+1)*o}convertExtentToRadians(t,i){this._isWebMercator?(i[0]=se(t[0]),i[1]=ae(t[1]),i[2]=se(t[2]),i[3]=ae(t[3])):this._isGCS&&(i[0]=W(t[0]),i[1]=W(t[1]),i[2]=W(t[2]),i[3]=W(t[3]))}getExtentGeometry(t,i,s,a=new Se){return this.getExtent(t,i,s,_),a.spatialReference=this.spatialReference,a.xmin=_[0],a.ymin=_[1],a.xmax=_[2],a.ymax=_[3],a.zmin=void 0,a.zmax=void 0,a}ensureMaxLod(t){if(t==null)return!1;let i=!1;for(;this.levels.length<=t;){const{resolution:s,scale:a}=this.levels[this.levels.length-1],n=s/2*this.pixelSize;this.levels.push({resolution:s/2,scale:a/2,tileSize:[n,n]}),i=!0}return i}capMaxLod(t){this.levels.length>t+1&&(this.levels.length=t+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(t){return this.levels[0].scale/2**t}levelAtScale(t){const i=this.levels[0].scale;return t>=i?0:Math.log(i/t)*Math.LOG2E}resolutionAtLevel(t){return this.levels[0].resolution/2**t}compatibleWith(t,i=1/0){if(g.checkUnsupported(t))return!1;const s=new g(t);if(!s.spatialReference.equals(this.spatialReference)||s.pixelSize!==this.pixelSize)return!1;const a=Math.min(this.levels.length-1,s.levels.length-1,i),n=this.levels[a].resolution;let r=.5*n;return!V(s.origin[0],this.origin[0],r)||!V(s.origin[1],this.origin[1],r)?!1:(r=.5*n/2**a/this.pixelSize*ht,V(n,s.levels[a].resolution,r))}rootTilesInExtent(t,i=null,s=1/0){const a=new Array,n=this.levels[0].tileSize;if(t==null||n[0]===0||n[1]===0)return a;g.computeRowColExtent(t,n,this.origin,_);let r=_[1],o=_[3],p=_[0],c=_[2];const m=c-p,B=o-r;if(m*B>s){const w=Math.floor(Math.sqrt(s));B>w&&(r=r+Math.floor(.5*B)-Math.floor(.5*w),o=r+w),m>w&&(p=p+Math.floor(.5*m)-Math.floor(.5*w),c=p+w)}for(let w=r;w<o;w++)for(let I=p;I<c;I++)a.push([0,w,I]);return i!=null&&(i[0]=this.origin[0]+p*n[0],i[1]=this.origin[1]-o*n[1],i[2]=this.origin[0]+c*n[0],i[3]=this.origin[1]-r*n[1]),a}static computeRowColExtent(t,i,s,a){const n=.001*(t[2]-t[0]+(t[3]-t[1]));a[0]=Math.max(0,Math.floor((t[0]+n-s[0])/i[0])),a[2]=Math.max(0,Math.ceil((t[2]-n-s[0])/i[0])),a[1]=Math.max(0,Math.floor((s[1]-t[3]+n)/i[1])),a[3]=Math.max(0,Math.ceil((s[1]-t[1]-n)/i[1]))}static isPowerOfTwo(t){const i=t.lods,s=i[0].resolution*2**i[0].level;return!i.some(a=>!$e(a.resolution,s/2**a.level))}static hasGapInLevels(t){const i=t.lods.map(s=>s.level);i.sort((s,a)=>s-a);for(let s=1;s<i.length;s++)if(i[s]!==i[0]+s)return!0;return!1}static tileSizeSupported(t){const i=t.size[1];return i===t.size[0]&&!(i&i-1)&&i>=128&&i<=512}static hasOriginPerLODs(t){const i=t.origin;return t.lods.some(s=>s.origin!=null&&(s.origin[0]!==i.x||s.origin[1]!==i.y))}static getMissingTileInfoError(){return new u("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(t){return t==null?Z():t.lods.length<1?new u("tilingscheme:generic","Tiling scheme must have at least one level"):g.isPowerOfTwo(t)?g.hasGapInLevels(t)?new u("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):g.tileSizeSupported(t)?g.hasOriginPerLODs(t)?new u("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new u("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new u("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(t,i){const s=t[2]-t[0],a=t[3]-t[1],n=xe(i),r=1.2*Math.max(s,a),o=256,p=r/o,c=p*n*(96/.0254),m=new g(new q({size:[o,o],origin:new P({x:t[0]-.5*(r-s),y:t[3]+.5*(r-a)}),lods:[new U({level:0,resolution:p,scale:c})],spatialReference:i}));return m.ensureMaxLod(20),m}static makeWebMercatorAuxiliarySphere(t){const i=new g(g.WebMercatorAuxiliarySphereTileInfo);return i.ensureMaxLod(t),i}static makeGCSWithTileSize(t,i=256,s=16){const a=256/i,n=new g(new q({size:[i,i],origin:new P({x:-180,y:90,spatialReference:t}),spatialReference:t,lods:[new U({level:0,resolution:.703125*a,scale:295497598570834e-6*a})]}));return n.ensureMaxLod(s),n}get test(){}};function Z(){return new u("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}M.WebMercatorAuxiliarySphereTileInfo=new q({size:[256,256],origin:new P({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:ie.WebMercator}),spatialReference:ie.WebMercator,lods:[new U({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),M.WebMercatorAuxiliarySphere=M.makeWebMercatorAuxiliarySphere(19);const _=j(),ce=64;Te(Re/10);const ut=j();M.WebMercatorAuxiliarySphere.getExtent(0,0,0,ut);j([-180,-90,180,90]);var x;(function(e){e[e.NORTH=0]="NORTH",e[e.NORTH_EAST=1]="NORTH_EAST",e[e.EAST=2]="EAST",e[e.SOUTH_EAST=3]="SOUTH_EAST",e[e.SOUTH=4]="SOUTH",e[e.SOUTH_WEST=5]="SOUTH_WEST",e[e.WEST=6]="WEST",e[e.NORTH_WEST=7]="NORTH_WEST"})(x||(x={}));function mt(e){return fe(e)||Me(e)||Be(e)}function fe(e){return Ee(e)||Ie(e)}const C=N(),dt=N(),T=N(),R=N();function ft(e,t,i=0){const s=e.extent;if(s==null)return!1;if(i===0)return Ce(s,t);const a=Math.min(s[2]-s[0],s[3]-s[1]);return ke(s,t,i*a)}function F(e,t,i,s){Oe(C,i),C[s]=t[s];const a=Q(C,C,t),n=Q(dt,e,t),r=ne(n,a),o=ne(a,a);let p;p=r<=0?t:o<=r?i:Ae(C,t,Ge(a,a,r/o));const c=Q(C,e,p);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function gt(e,t,i){const s=e.extent;if(s==null)return 0;T[0]=s[0],T[1]=s[1],T[2]=i,R[0]=s[2],R[1]=s[3],R[2]=i;let a=1/0,n=1/0;return t[0]<T[0]?a=F(t,T,R,0):t[0]>R[0]&&(a=F(t,R,T,0)),t[1]<T[1]?n=F(t,T,R,1):t[1]>R[1]&&(n=F(t,R,T,1)),Math.min(a,n)}function yt(e,t,i,s){if(e==null)return Z();const a=e.spatialReference;if(a.isGeographic&&!fe(a))return new u("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const n=M.checkUnsupported(e);return n??(i==null?new u("tilingscheme:extent-not-exist","The layer does not provide a layer extent."):bt(e,i)||(t==null||a.equals(t)||t.isWGS84&&a.isWebMercator?null:new u("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")))}function bt(e,t){const i=e.lods,s=i[0].resolution*2**i[0].level,a=[s*e.size[0],s*e.size[1]],n=[e.origin.x,e.origin.y],r=Le(t),o=j();M.computeRowColExtent(r,a,n,o);const p=(o[2]-o[0])*(o[3]-o[1]);if(p>ce){const c=i[0].scale*2**i[0].level;let m=Math.max((r[3]-r[1])/e.size[1],(r[2]-r[0])/e.size[0])*c/s;const B=Math.floor(Math.log(m)/Math.log(10));return m=Math.ceil(m/10**B)*10**B,new u("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+m.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:m,requiredNumRootTiles:p,allowedNumRootTiles:ce})}return null}const wt=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:yt,isInsideExtent:ft,tiltToExtentEdge:gt},Symbol.toStringTag,{value:"Module"}));function vt(){return!0}function _t(){return 0}function St(e,t,i,s){if(e==null)return Z();const a=(e==null?void 0:e.lods.length)-1,n=e.spatialReference;if(n.isWebMercator){if(!M.makeWebMercatorAuxiliarySphere(a).compatibleWith(e,s))return new u("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!mt(n))return new u("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!M.makeGCSWithTileSize(e.spatialReference,e.size[0],a).compatibleWith(e,s))return e.spatialReference.isWGS84?new u("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new u("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return t==null||e.spatialReference.equals(t)?null:new u("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}const $t=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:St,isInsideExtent:vt,tiltToExtentEdge:_t},Symbol.toStringTag,{value:"Module"})),xt={[D.Global]:$t,[D.Local]:wt};function Y(e,t,i,s,a){return xt[s].checkIfTileInfoSupportedForViewSR(e,i,t,a)}function Tt(e,t,i){const s=ze(e);if(s!=null){if(!k.isCollection(s))return{tileInfo:s.tileInfo,fullExtent:s.fullExtent};{const a=s.find(n=>Y(n.tileInfo,n.fullExtent,t,i)==null);if(a)return{tileInfo:a.tileInfo,fullExtent:a.fullExtent}}}return{tileInfo:null,fullExtent:null}}x.NORTH,x.EAST,x.SOUTH,x.WEST;x.NORTH_EAST,x.SOUTH_EAST,x.SOUTH_WEST,x.NORTH_WEST;async function Rt(e,t={}){const{basemap:i,view:s}=e;await i.load(t),Bt(i),await It(i,s,t),H(t)}async function Mt(e,t={}){var o,p;const{basemap:i,view:s}=e;H(t);const a=(o=i.baseLayers.find(c=>c.type==="unknown"))==null?void 0:o.loadError;if(a!=null)throw a;if(!s||"spatialReferenceLocked"in s&&!s.spatialReferenceLocked||(await i.load(t),H(t),i.baseLayers.length===0))return;const n=i.baseLayers.at(0);if(!We(n))return;if(i.spatialReference){if(s.spatialReference.equals(i.spatialReference))return;pe()}await n.load(t),H(t);const r=(("supportedSpatialReferences"in n?n.supportedSpatialReferences:null)||["tileInfo"in n?(p=n.tileInfo)==null?void 0:p.spatialReference:null]).filter(Fe);r.length!==0&&r.every(c=>!s.spatialReference.equals(c))&&pe()}function pe(){throw new u("basemap-compatibility:incompatible-spatial-reference","Basemap spatial reference is not compatible with the view")}function Bt(e){if(e.baseLayers.length===0&&e.referenceLayers.length===0)return;const t=e.baseLayers.concat(e.referenceLayers).toArray().filter(i=>!Pe(i)).map(i=>Et(i));if(t.length)throw t[0]}function Et(e){return new u("basemap-compatibility:unsupported-basemap-layer-type","Unsupported basemap layer type ${operationalLayerType}",{layer:e,operationalLayerType:e.operationalLayerType||"unknown"})}async function It(e,t,i){if(e.baseLayers.length===0)return;const s=e.baseLayers.at(0);if(He(s)){try{await s.load(i)}catch(a){const n="basemap-compatibility:unknown-error",r="Unknown basemap compatibility error",{name:o=n,message:p=r,details:c}=a;throw new u(o,p,c)}Ct(s,t)}}function Ct(e,t){var o;const i=t.state.viewingMode;if(!i)return;let s,a;if((e==null?void 0:e.type)==="wmts"){const p=Tt(e,t.spatialReference,i);if(p.tileInfo==null)throw new u("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view");s=p.tileInfo,a=p.fullExtent}else s=e.tileInfo,a=e.fullExtent;if(s==null)return;if(!pt(s.spatialReference,i))throw new u(`basemapgalleryitem:spatial-reference-unsupported-${oe(i)}`,`Basemap spatial reference is unsupported in ${oe(i)} mode`);const n=(e==null?void 0:e.type)==="vector-tile"?s.getCompatibleForVTL(256):null;if(i===D.Global){let p=Y(s,a,null,i);if(p&&(e==null?void 0:e.type)==="vector-tile"&&a!=null&&n&&!Y(n,a,null,i)&&(p=null),p){const c=s.spatialReference.isWebMercator?"web-mercator":"wgs84";throw new u(`basemapgalleryitem:tiling-scheme-unsupported-${c}-global`,"Basemap tiling scheme is unsupported in global mode",{error:p})}}else if(M.checkUnsupported(s))throw new u("basemapgalleryitem:tiling-scheme-unsupported-local","Basemap tiling scheme is unsupported in local mode");const r=(o=t.basemapTerrain)==null?void 0:o.tilingScheme;if(r&&!r.compatibleWith(s)&&((e==null?void 0:e.type)!=="vector-tile"||!n||!r.compatibleWith(n)))throw new u("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view")}let S=class extends qe(he){constructor(e){super(e),this.compatibilityFunction=null,this.error=null,this.state="loading",this.view=null}initialize(){const e=()=>this.refresh();this.addHandles([E(()=>{var t;return(t=this.basemap)==null?void 0:t.loadStatus},e),E(()=>this.compatibilityFunction,e),E(()=>{var t;return this.view&&"basemapTerrain"in this.view&&((t=this.view.basemapTerrain)==null?void 0:t.tilingScheme)},e),E(()=>{var t;return(t=this.view)==null?void 0:t.ready},e),E(()=>{var t;return(t=this.view)==null?void 0:t.spatialReference},e)]),this.refresh()}destroy(){this._cancelRefresh(),this.basemap=null,this.compatibilityFunction=null,this.view=null}get _spatialReferenceTask(){return Ze(this.view,this.basemap)}set basemap(e){e&&e.load().catch(()=>{}),this._set("basemap",e)}get spatialReference(){return this._spatialReferenceTask.spatialReference}refresh(){var s;this._cancelRefresh(),this._set("state","loading");const e=(s=this.basemap)==null?void 0:s.loadStatus;if(e!=="loaded"&&e!=="failed")return;if(!this.compatibilityFunction)return void(e==="loaded"?(this._set("state","ready"),this._set("error",null)):(this._set("state","error"),this._set("error",this.basemap.loadError)));const t=new AbortController,{signal:i}=t;this.compatibilityFunction(this,{signal:i}).then(()=>Ue(()=>!this._spatialReferenceTask.updating,i)).then(()=>{this._set("state","ready"),this._set("error",null)}).catch(a=>{ue(a)||(this._set("state","error"),this._set("error",a))}),this._refreshController=t}_cancelRefresh(){this._refreshController&&(this._refreshController.abort(),this._refreshController=null)}};l([h({readOnly:!0})],S.prototype,"_spatialReferenceTask",null),l([h()],S.prototype,"basemap",null),l([h()],S.prototype,"compatibilityFunction",void 0),l([h({readOnly:!0})],S.prototype,"error",void 0),l([h({readOnly:!0})],S.prototype,"spatialReference",null),l([h({readOnly:!0})],S.prototype,"state",void 0),l([h()],S.prototype,"view",void 0),S=l([z("esri.widgets.BasemapGallery.support.BasemapGalleryItem")],S);const ge=S,ye=k.ofType(X);let A=class extends he{constructor(e){super(e),this.basemaps=new ye}destroy(){this.basemaps.forEach(e=>e.destroy())}get state(){return"ready"}refresh(){}};l([h({type:ye})],A.prototype,"basemaps",void 0),l([h({readOnly:!0})],A.prototype,"state",null),A=l([z("esri.widgets.BasemapGallery.support.LocalBasemapsSource")],A);const be=A,we=k.ofType(X);let $=class extends J.LoadableMixin(De(be)){constructor(t){super(t),this._lastPortalBasemapFetchController=null,this.basemaps=new we,this.filterFunction=null,this.portal=me.getDefault(),this.query=null,this.updateBasemapsCallback=null,this.viewType=null}initialize(){this.addHandles(E(()=>{var t,i,s;return[this.filterFunction,this.loadStatus,(t=this.portal)==null?void 0:t.basemapGalleryGroupQuery,(i=this.portal)==null?void 0:i.basemapGalleryGroupQuery3D,(s=this.portal)==null?void 0:s.user,this.query,this.updateBasemapsCallback]},()=>this.refresh(),je))}destroy(){this.filterFunction=null,this.portal=null,this.basemaps.forEach(t=>t.destroy())}get state(){return this.loadStatus==="not-loaded"?"not-loaded":this.loadStatus==="loading"||this._lastPortalBasemapFetchController?"loading":"ready"}load(t){return this.addResolvingPromise(this.portal.load(t)),Promise.resolve(this)}async refresh(){if(this.loadStatus!=="loaded")return;this._lastPortalBasemapFetchController&&(this._lastPortalBasemapFetchController.abort(),this._lastPortalBasemapFetchController=null);const t=this.portal,i=new AbortController;this._lastPortalBasemapFetchController=i,this.notifyChange("state");try{const s=await t.fetchBasemaps(this._toQueryString(this.query),{signal:i.signal,include3d:this.viewType==="3d"||void 0});await this._updateBasemaps(s)}catch(s){if(ue(s))throw s;Ne.getLogger(this).warn(new u("basemap-source:fetch-basemaps-error","Could not fetch basemaps from portal.",{error:s})),await this._updateBasemaps()}this._lastPortalBasemapFetchController=null,this.notifyChange("state")}_toQueryString(t){return t&&typeof t!="string"?Object.keys(t).map(i=>`${i}:${t[i]}`).join(" AND "):t}async _updateBasemaps(t=[]){let i=await this._filterBasemaps(t);i=this.updateBasemapsCallback?await this.updateBasemapsCallback(i):i,this.basemaps.removeAll(),this.basemaps.addMany(i)}async _filterBasemaps(t){if(!this.filterFunction)return t;const i=t.map(this.filterFunction),s=await Promise.all(i);return t.filter((a,n)=>s[n])}};l([h({readOnly:!0,type:we})],$.prototype,"basemaps",void 0),l([h()],$.prototype,"filterFunction",void 0),l([h({type:me})],$.prototype,"portal",void 0),l([h()],$.prototype,"query",void 0),l([h({readOnly:!0})],$.prototype,"state",null),l([h()],$.prototype,"updateBasemapsCallback",void 0),l([h()],$.prototype,"viewType",void 0),$=l([z("esri.widgets.BasemapGallery.support.PortalBasemapsSource")],$);const G=$,ve=k.ofType(ge);function kt(e){return e&&e.declaredClass==="esri.portal.Portal"}function Lt(e){return e&&!(e instanceof G)&&(!!e.portal||!!e.query)}function Ot(e){return e&&"basemaps"in e&&"state"in e&&"refresh"in e}let v=class extends J{constructor(e){super(e),this._loadingProjectionEngine=!1,this.items=new ve,this.source=new G,this.view=null}initialize(){const e=()=>this._recreateItems();this.addHandles([E(()=>this.state==="ready"?this.compatibilityFunction:null,()=>this._updateItems()),Qe(()=>{var t;return(t=this.source)==null?void 0:t.basemaps},"change",e,{onListenerAdd:e}),de(()=>this.view,()=>{var t;this.source instanceof G&&(this.source.viewType=(t=this.view)==null?void 0:t.type)},{once:!0})])}destroy(){var t;const e=this.source.basemaps.find(i=>i===this.activeBasemap);e&&this.source.basemaps.remove(e),(t=this.source)==null||t.destroy()}get activeBasemap(){var e,t;return((t=(e=this.view)==null?void 0:e.map)==null?void 0:t.basemap)??null}set activeBasemap(e){var a,n;const t=this.view;if(!(t!=null&&t.map))return;const i=typeof e=="string"?X.fromId(e):e;if(!i||!t.ready)return t.map.basemap=i,void this._clearOverride("activeBasemap");const s=i.spatialReference||((n=(a=this.items)==null?void 0:a.find(r=>this.basemapEquals(i,r.basemap)))==null?void 0:n.spatialReference);if(s&&"spatialReferenceLocked"in t&&!t.spatialReferenceLocked){const r=t.spatialReference;if(s!=null&&!re(r,s)&&!Ke(t.spatialReference,s)&&!Je())return this._override("activeBasemap",i),this._loadingProjectionEngine=!0,void Ye().then(()=>{this._get("activeBasemap")===e&&(t.map.basemap=e,t.spatialReference=s,this._clearOverride("activeBasemap"))},()=>{}).then(()=>{this._loadingProjectionEngine=!1});t.map.basemap=i,this._clearOverride("activeBasemap"),s==null||re(t.spatialReference,s)||(t.spatialReference=s)}else t.map.basemap=i,this._clearOverride("activeBasemap")}get activeBasemapIndex(){const{state:e,activeBasemap:t}=this;return e!=="ready"?-1:this._findBasemapIndex(t)}get compatibilityFunction(){var e;return((e=this.view)==null?void 0:e.type)==="3d"?Rt:Mt}set compatibilityFunction(e){this._overrideIfSome("compatibilityFunction",e)}castSource(e){return Array.isArray(e)||k.isCollection(e)?new be({basemaps:Array.isArray(e)?new k(e):e}):kt(e)?new G({portal:e}):Lt(e)?new G(e):Ot(e)?e:null}get state(){var e;return(e=this.view)!=null&&e.ready&&this.source?this._loadingProjectionEngine?"loading":"ready":"disabled"}basemapEquals(e,t){return et(e,t)}refresh(){this._recreateItems()}load(){return this.loadSource()}loadSource(e){return this.addResolvingPromise(J.isLoadable(this.source)?this.source.load(e):null),Promise.resolve(this)}_findBasemapIndex(e){const{items:t}=this,i=t.findIndex(s=>s.basemap===e);return i===-1?t.findIndex(s=>this.basemapEquals(s.basemap,e)):i}_recreateItems(){var n;const e=((n=this.source)==null?void 0:n.basemaps)??[],{view:t,compatibilityFunction:i}=this,s=new Map(this.items.map(r=>[r.basemap,r])),a=e.map(r=>{const o=s.get(r);return o?(s.delete(r),o):new ge({basemap:r,compatibilityFunction:i,view:t})});this.items.removeAll(),this.items.addMany(a),s.forEach(r=>r.destroy())}_updateItems(){for(const e of this.items)e.compatibilityFunction=this.compatibilityFunction,e.view=this.view}};l([h()],v.prototype,"_loadingProjectionEngine",void 0),l([h()],v.prototype,"activeBasemap",null),l([h({readOnly:!0})],v.prototype,"activeBasemapIndex",null),l([h()],v.prototype,"compatibilityFunction",null),l([h({readOnly:!0,type:ve})],v.prototype,"items",void 0),l([h()],v.prototype,"source",void 0),l([Ve("source")],v.prototype,"castSource",null),l([h({readOnly:!0})],v.prototype,"state",null),l([h()],v.prototype,"view",void 0),v=l([z("esri.widgets.BasemapGallery.BasemapGalleryViewModel")],v);const At=v,y="esri-basemap-gallery",b={base:y,sourceLoading:`${y}--source-loading`,layoutGrid:`${y}--grid`,narrowItems:`${y}--narrow-items`,loader:`${y}__loader`,item:`${y}__item`,itemContainer:`${y}__item-container`,itemContent:`${y}__item-content`,itemTitle:`${y}__item-title`,itemTagsContainer:`${y}__item-tags-container`,itemThumbnail:`${y}__item-thumbnail`,selectedItem:`${y}__item--selected`,itemError:`${y}__item--error`},K={small:200,default:280,wide:420};let d=class extends nt{constructor(e,t){super(e,t),this.disabled=!1,this.headingLevel=2,this.messages=null,this.viewModel=new At,this._focusBasemapItemEnabled=!1,this._container=null,this._width=0,this._onContainerCreated=i=>{this._container=i}}initialize(){this.addHandles([rt(()=>this._container,({contentRect:e})=>{this._width=e.width}),de(()=>this.source,()=>this.viewModel.loadSource(),{sync:!0,initial:!0})])}loadDependencies(){return lt({scrim:()=>le(()=>import("./calcite-scrim-BVz2eq8G.js"),__vite__mapDeps([0,1,2])),chip:()=>le(()=>import("./calcite-chip-4IvQqaFU.js"),__vite__mapDeps([3,1,2]))})}get activeBasemap(){return this.viewModel.activeBasemap}set activeBasemap(e){this.viewModel.activeBasemap=e}get icon(){return"basemap"}set icon(e){this._overrideIfSome("icon",e)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get source(){return this.viewModel.source}set source(e){this.viewModel.source=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e=this.source.state==="loading",t=this.disabled||this.viewModel.state==="disabled",i=this.viewModel.items,s={[b.sourceLoading]:e,[O.disabled]:t},a=this._width;a<=K.small||a>=K.wide?s[b.layoutGrid]=!0:a<K.default&&(s[b.narrowItems]=!0);const n=e?f("div",{class:b.loader,key:"loader"}):null,r=e?null:i.length>0?f("ul",{"aria-disabled":this.disabled,"aria-label":this.label,bind:this,class:b.itemContainer,key:"item-container",onkeydown:this._handleKeyDown,role:"radiogroup"},i.map((o,p)=>this._renderBasemapGalleryItem(o,p)).toArray()):f("div",{class:O.empty,key:"empty-message"},f(ot,{level:this.headingLevel},this.messages.noBasemaps));return f("div",{afterCreate:this._onContainerCreated,class:this.classes(b.base,O.widget,O.panel,s),key:"container"},this._width===0?null:[n,r])}_getRoundRobinIndex(e,t){return(e+t)%t}_handleKeyDown(e){const{key:t}=e;if(!["ArrowUp","ArrowDown","ArrowRight","ArrowLeft"].includes(t))return;e.preventDefault();const{items:i,activeBasemapIndex:s}=this.viewModel,a=t==="ArrowUp"||t==="ArrowLeft"?this._getRoundRobinIndex(Math.max(s-1,-1),i.length):this._getRoundRobinIndex(s+1,i.length),n=i.at(a);(n==null?void 0:n.state)==="ready"&&(this.viewModel.activeBasemap=n.basemap),this._focusBasemapItemEnabled=!0}_focusBasemapItem(e){this._focusBasemapItemEnabled&&e.tabIndex===0&&(e.focus(),this._focusBasemapItemEnabled=!1)}_handleClick(e){const t=e.currentTarget["data-item"];t.state==="ready"&&(this.viewModel.activeBasemap=t.basemap)}_renderBasemapGalleryItem(e,t){var ee,te;const i=tt(e.basemap)||Xe("esri/themes/base/images/basemap-toggle-64.svg"),s=e.basemap.title,a=(ee=e.basemap.portalItem)==null?void 0:ee.snippet,n=((te=e.error)==null?void 0:te.message)||a||s,{viewModel:{state:r,activeBasemapIndex:o}}=this,p=this.disabled||r==="disabled",c=o===t,m=c||o===-1&&t===0?0:-1,B=r==="loading",w={[b.selectedItem]:c,[b.itemError]:e.state==="error"},I=`basemapgallery-item-${e.uid}`;return f("li",{afterUpdate:this._focusBasemapItem,"aria-checked":c.toString(),"aria-disabled":p.toString(),"aria-labelledby":I,bind:this,class:this.classes(b.item,w),"data-item":e,key:e.uid,onclick:this._handleClick,onkeydown:this._handleClick,role:"radio",tabIndex:m,title:n},f("img",{alt:"",class:b.itemThumbnail,src:i}),f("div",{class:b.itemContent,key:"content"},f("div",{class:b.itemTitle,key:"title"},f("span",{id:I},s)),it(e.basemap)?this._renderTags(e.basemap):null),e.state==="loading"||c&&B?f("calcite-scrim",null,f("span",{"aria-hidden":"true",class:O.loaderAnimation,key:"loader",role:"presentation"})):null)}_renderTags(e){return f("div",{class:b.itemTagsContainer,key:"tag"},this._render3DTag(),st(e)?this._renderBetaTag():null)}_render3DTag(){const{messages:e}=this;return f("calcite-chip",{key:"tag-3d",scale:"s",value:e.tag3D},this.messages.tag3D)}_renderBetaTag(){const{messages:e}=this;return f("calcite-chip",{appearance:"outline-fill",key:"tag-beta",scale:"s",value:e.tagBeta},this.messages.tagBeta)}};l([h()],d.prototype,"activeBasemap",null),l([h()],d.prototype,"disabled",void 0),l([h()],d.prototype,"headingLevel",void 0),l([h()],d.prototype,"icon",null),l([h()],d.prototype,"label",null),l([h(),at("esri/widgets/BasemapGallery/t9n/BasemapGallery")],d.prototype,"messages",void 0),l([h()],d.prototype,"source",null),l([h()],d.prototype,"view",null),l([h()],d.prototype,"viewModel",void 0),l([h()],d.prototype,"_focusBasemapItemEnabled",void 0),l([h()],d.prototype,"_container",void 0),l([h()],d.prototype,"_width",void 0),l([ct()],d.prototype,"_handleClick",null),d=l([z("esri.widgets.BasemapGallery")],d);const Kt=d;export{Kt as default};
